
<HTML>
    <HEAD>
        <TITLE>Microsoft Out-of-Box Experience</TITLE>
        <META http-equiv="Content-Type" content="text/html; charset=iso-8859-1">
        <LINK REL="stylesheet" TYPE="text/css" HREF="setup\oobestyl.css">
		


        <!-- Begin Agent Specific Code -->

            <!-- The majority of the Agent code is in AgtCore.js -->
            <!-- The AgtXXXX.js files contain all of the script  -->
            <!-- code that needs to be localized.                -->
            <!-- NOTE: Agent is not initialized until the first  -->
            <!-- time someone clicks on the Assistant image.     -->

            <script language=jscript src="AgtCore.js"></script>
            <script language=jscript src="AgtScrpt.js"></script>
            <script language=jscript src="AgtScrp2.js"></script>

            <!-- Agent Event Handler Declarations -->

            <script language=jscript for=Agent event="Command(userInput)")>
                Agent_OnCommand(userInput);
            </script>

            <script language=jscript for=Agent event="Hide(characterID)">
                Agent_OnHide(characterID);
            </script>

            <script language=jscript for=Agent event="IdleStart(characterID)">
                Agent_OnIdleStart(characterID);
            </script>

            <script language=jscript for=Agent event="IdleComplete(characterID)">
                Agent_OnIdleComplete(characterID);
            </script>

            <script language=jscript for=Agent event="Bookmark(id)">
                Agent_OnBookmark(id);
            </script>

            <script language=jscript for=Agent event="Click(characterID, button, shift, x, y)">
                Agent_OnClick(characterID, button, shift, x, y);
            </script>

            <script language=jscript for=Agent event="DragComplete(characterID, button, shift, x, y)">
                Agent_OnDragComplete(characterID, button, shift, x, y);
            </script>

            <script language=jscript for=Agent event="RequestComplete(request)">
                Agent_OnRequestComplete(request);
            </script>


        <!-- End Agent Specific Code -->

        <!-- Windows Media Player sends this event upon any error it encounters -->
        <script language=jscript for=IntroAnimation event="error()">
            if (IntroAnimation.playState!=3)
            {
                VideoGoNext('Error');
            }
        </Script>

        <!-- Windows Media Player sends this event upon any changes in the play state -->
        <script language=jscript for=IntroAnimation event="PlayStateChange(bResult)">
            if (bResult==3)
            {
                trace("PlayStateChange " + bResult);
                try
                {
                    IntroAnimation.fullscreen = "true";
                }
                catch(err)
                {
                    var temp = "EXCEPTION THROWN: WMP control failed to go to full screen.";
                    temp += "\rerror name: " + err.name;
                    temp += "\rmessage: " + err.message;
                    temp += "\rnumber: " + err.number;
                    temp += "\rdescription: " + err.description;
                    trace(temp);
                }
                g_fHasPlayed=true;
            }
            else if ( g_fHasPlayed || (bResult==8) )
            {
                trace("PlayStateChange " + bResult);
                VideoGoNext('PlayStateChanged');
            }
        </script>

        <script language=jscript src="mousetut.js"></script>

        <script language=jscript src="oobeutil.js"></script>

        <script language=jscript src="migrate.js"></script>

        <script language=jscript src="dialmgr.js"></script>

        <script language=jscript src="error.js"></script>

        <script language=jscript src="icsmgr.js"></script>

        <script language=jscript src="isptype.js"></script>

        <script language=jscript src="iconnect.js"></script>

        <script language=jscript src="dslmain.js"></script>

        <script language=jscript src="sconnect.js"></script>

        <script language=jscript>









var APP_OOBE_MODE     = 0;
var APP_MSN_MODE      = 4;
var APP_DESKTOP_MODE  = 2;
var SM_STARTER = 88;

var g_fHasPlayed = false;
var g_VideoEvent = null;


var STATUS_ISP = 0;             
var STATUS_PRECONFIG = 1;       
var STATUS_NONE = 2;            
var STATUS_OFF = 3;             
var STATUS_MAX = 4;

var SNDX_MSN_ISP = 1;
var SNDX_MSN_REG = 2;
var SNDX_MSN_FINISH = 3;
var SNDX_OEM_REG = 1;
var SNDX_OEM_ISP = 2;
var SNDX_OEM_FINISH = 3;
var SNDX_NONE_REG = 1;
var SNDX_NONE_FINISH = 2;
var SNDX_OFF_EULA = 1;
var SNDX_OFF_PID = 2;
var SNDX_OFF_FINISH = 3;














var SNDX_WELCOME    = 0;
var SNDX_HW         = 1;
var SNDX_LEGAL      = 2;
var SNDX_REG        = 3;
var SNDX_ISP        = 4;
var SNDX_IDENTITIES = 5;
var SNDX_FINI       = 6;


var g_SimpleNavMap = null;







function CheckPoint(strURL, i1, i2, i3, i4)
{
    this.strURL = strURL;
    this.rgindex = new Array(STATUS_MAX);
    this.rgindex[STATUS_ISP] = i1;
    this.rgindex[STATUS_PRECONFIG] = i2;
    this.rgindex[STATUS_NONE] = i3;
    this.rgindex[STATUS_OFF] = i4;
}

var curCKPT                 = 1;
var CKPT_ANIMATION          = curCKPT++;
var CKPT_HWCHK              = curCKPT++;
var CKPT_WELCOME            = curCKPT++;
var CKPT_OOBEDISC           = curCKPT++;
var CKPT_MOUSETUT1          = curCKPT++;
var CKPT_IMETUTORIAL        = curCKPT++;
var CKPT_OEMHW              = curCKPT++;
var CKPT_REGION_KEYBD       = curCKPT++;
var CKPT_REGKB_COMMIT       = curCKPT++;
var CKPT_TIMEZONE           = curCKPT++;
var CKPT_EULA               = curCKPT++;
var CKPT_EULA_DECLINE       = curCKPT++;
var CKPT_PRODUCTKEY         = curCKPT++;
var CKPT_BADPRODUCTKEY      = curCKPT++;
//var CKPT_AUTO_UPDATE        = curCKPT++;
var CKPT_COMPNAME           = curCKPT++;
var CKPT_SECPASS            = curCKPT++;
var CKPT_JNDOMAIN           = curCKPT++;
var CKPT_ICSCHOICE          = curCKPT++;
var CKPT_HOMENETWIZPROMPT   = curCKPT++;
var CKPT_DSLMAIN            = curCKPT++;
var CKPT_DSLPPPOE           = curCKPT++;
var CKPT_DSLBROADBAND       = curCKPT++;
var CKPT_CONGRATS           = curCKPT++;
var CKPT_ACTIVATION         = curCKPT++;
var CKPT_REGISTER1          = curCKPT++;
var CKPT_REGISTER3          = curCKPT++;
var CKPT_ACT_MSG            = curCKPT++;
var CKPT_ICONN              = curCKPT++;
var CKPT_ISPSIGNUP          = curCKPT++;
var CKPT_MIGLIST            = curCKPT++;
var CKPT_ISPDIAL            = curCKPT++;
var CKPT_REFDIAL            = curCKPT++;
var CKPT_MIGDIAL            = curCKPT++;
var CKPT_REGDIAL            = curCKPT++;
var CKPT_ISPTYPE            = curCKPT++;
var CKPT_ICONNECT           = curCKPT++;
var CKPT_SCONNECT           = curCKPT++;
var CKPT_OEMISP             = curCKPT++;
var CKPT_OEMCUST            = curCKPT++;
var CKPT_IDENTITIES2        = curCKPT++;
var CKPT_DONE               = curCKPT++;
var CKPT_MAX                = curCKPT;  

var dnCKPT = new Array(CKPT_MAX);



var g_CurrentCKPT = null;
var g_DialCKPT = null;
var HKEY_LOCAL_MACHINE = 0x80000002;
var REGISTERED_OWNER_KEY = "SOFTWARE\\Microsoft\\Windows NT\\CurrentVersion";
var REGISTERED_OWNER_VALUE = "RegisteredOwner";
var OOBE_MAIN_REG_KEY = "SOFTWARE\\Microsoft\\Windows\\CurrentVersion\\Setup\\OOBE";
var CLSID_FLASH_PLAYER = "{D27CDB6E-AE6D-11cf-96B8-444553540000}";
var PROGID_FLASH_PLAYER = "ShockwaveFlash.ShockwaveFlash";
var CKPT_REG_KEY = "\\CKPT";
var TOS_REG_VALUE = "TopOfStack";


var PREFCONN_REG_VALUE = "PreferredConnection";

var POWERDOWN_SHUTDOWN  = 0;
var POWERDOWN_REBOOT    = 1;


var ERR_COMM_NO_ERROR            = 0;
var ERR_COMM_OOBE_COMP_MISSING   = 1;
var ERR_COMM_UNKNOWN             = 2;        
var ERR_COMM_NOMODEM             = 3;        
var ERR_COMM_RAS_TCP_NOTINSTALL  = 4;
var ERR_COMM_ISDN                = 5;
var ERR_COMM_PHONE_AND_ISDN      = 6;


var DERR_DIALTONE           = 680;
var DERR_BUSY               = 676;
var DERR_VOICEANSWER        = 677;
var DERR_NOANSWER           = 678;
var DERR_NO_CARRIER         = 679;
var DERR_HARDWARE_FAILURE   = 630;   
var DERR_PORT_ALREADY_OPEN  = 602;   
var DERR_PORT_OR_DEVICE     = 692;   
var DERR_PPP_TIMEOUT        = 718;
var DERR_REMOTE_DISCONNECT  = 629;   


var CONNECTED_REFFERAL       = 1
var CONNECTED_ISP_SIGNUP     = 2
var CONNECTED_ISP_MIGRATE    = 3
var CONNECTED_REGISTRATION   = 4



var COMPNAME_SUCCESS        = 0;
var COMPNAME_INVALIDNAME    = 1;





var FINISH_OK           = 0x00000000;
var FINISH_REBOOT       = 0x00000001;
var FINISH_BAD_PID      = 0x00000002;
var FINISH_BAD_EULA     = 0x00000004;
var FINISH_BAD_STAMP    = 0x00000008;





var JOIN_STATUS_UNKNOWN         = 0;
var JOIN_STATUS_UNJOINED        = 1;
var JOIN_STATUS_WORKGROUP       = 2;
var JOIN_STATUS_DOMAIN          = 3;


var LANGUAGE_REBOOT_NEVER   = 0;
var LANGUAGE_REBOOT_NOW     = 1;
var LANGUAGE_REBOOT_END     = 2;


var HIDE_BACK = 0x0001;
var HIDE_NEXT = 0x0002;
var HIDE_CANCEL = 0x0004;
var HIDE_RESTORE = 0x0008;


var NOLAUNCHISPSIGNUP     = "{C37D92A5-CA34-11d2-B71C-00C04F794977}";
var MSNCOMPLETED          = "{1C0A22F2-CB6B-11d2-B544-00A0C949DA70}";
var LANGUAGECOMPLETED     = "{F744DA40-617C-11D3-8B99-00A0C91E7F3C}";
var MS_REGISTRATION       = "{1C956940-8617-11D3-8B99-00A0C91E7F3C}";
var OEM_REGISTRATION      = "{ECD24360-B210-11D3-8B99-00A0C91E7F3C}";


var TapiObj = null;
var InfoObj = null;
var EulaObj = null;
var LangObj = null;
var PidObj  = null;
var AutoUpdateObj = null;
var StatusObj = null;
var DirObj = null;
var ApiObj = null;
var SysClockObj = null;
var RegisterObj = null;
var FileSystemObj = null;
var g_Identities2_OK;


var L_Blank_Text = "";
var L_Administrator_Text = "ADMINISTRATOR";
var L_Guest_Text = "GUEST";


var g_strISPFile = "";
var g_bStartup;
var g_LastButtonText = null;
var g_FirstFocusElement = null;
var g = null;
var g_SpecialChars = ".'-` ";
var g_OOBEDir = "file://" + window.external.API.get_SystemDirectory() + "\\oobe\\";
var g_OOBEDirPath = window.external.API.get_SystemDirectory() + "\\oobe\\";
var g_bRedial = false;
var g_LineProblem = 0;
var g_bFirstServerError = true;
var g_status = STATUS_OFF;
var g_ServerErrorCount = 0;
var g_IMEExists = false;
var g_OEMAddBackURL = "";
var g_DialingAvailableInCountry = true;
var g_ModalDialogUp = false;
var bKeyboardPresent = true;
var bMousePresent = true;
var g_OEMNameStr = window.external.Signup.get_OEMName();
var g_bTapiDone = false;
var g_CompNameChangeComplete = false;
var g_fFirewallRequired      = false;
var g_bIsSetupUpgrade = false;
var g_bInHighScreenRes = false;



var DisplayIcsCongratsPage = true;




var g_DidWePassWelcomePage = false;



if (null == FileSystemObj) {
    FileSystemObj = new ActiveXObject("Scripting.FileSystemObject");
}

if (null == ApiObj)
{
    ApiObj = new Object;
    ApiObj = window.external.API;
}
if (null == StatusObj)
{
    StatusObj = new Object;
    StatusObj = window.external.Status;
}
if (null == DirObj)
{
    DirObj = new Object;
    DirObj = window.external.Directions;
}
if (null == InfoObj)
{
    InfoObj = new Object;
    InfoObj = window.external.UserInfo;
}
if (null == TapiObj)
{
    TapiObj = new Object;
    TapiObj = window.external.Tapi;
}
if (null == RegisterObj)
{
    RegisterObj = new Object;
    RegisterObj = window.external.Register;
}
if (null == SysClockObj)
{
    SysClockObj = new Object;
    SysClockObj = window.external.SystemClock;
    SysClockObj.Init();
}

if (null == LangObj)
{
    LangObj = new Object;
    LangObj = window.external.Language;
}




var g_AgentDisabled = (DirObj.get_AgentDisabled() || DirObj.get_IntroOnly());

var L_ContStr_Text="To continue, click";
var L_NextStr_Text="Next";
var L_Period_Text=".";
var L_ClickNextLocStr_Text="";  

var L_NextStrTopPercent_Text="83%";
var L_ClickNextStrTopPercent800_Text="78%";
var L_ClickNextStrTopPercent1024_Text="84%";
var L_ClickNextStrLeftPercent_Text="30%";

var g_ClickNextStr = "&nbsp;"

var g_ClickNextStrWelcome = "";


var L_ConnectedDefaultHeading_Text         = "Congratulations";
var L_ConnectedNoInternetHeading_Text      = "Could not find the Internet";

var L_ConnectedDefault_Text         = "You are now connected to the Internet.";
var L_ConnectedViaICS_Text         = "You are now connected to the Internet using ICS connection.";
var L_ConnectedViaDSLCable_Text    = "You are now connected to the Internet via your DSL/Cable connection.";
var L_ConnectedViaLAN_Text         = "You are now connected to the Internet using your LAN connection.";
var L_ConnectedNoInternet_Text      = "Windows was not able to connect to the Internet using your network hardware. You can connect to the Internet later by clicking the Start button, then click <B>Internet</B>.  Please click the <B>Next</B> button below to continue setting up Windows.";


var g_Congrats_Type_Heading = L_ConnectedDefaultHeading_Text;
var g_Congrats_Type         = L_ConnectedDefault_Text;










function logError(funcName, errObj)
{
    trace(   "Exception in " + funcName
            +  " (" + errObj.number.toString(16) + ") "
            + errObj.description + "\n"
         );
    if (true == DebugObj.get_MsDebugMode())
    {
        alert("OOBE ERROR\n"
                + "\n   Function: " + funcName
                + "\n      Error: " + errObj.number.toString(16)
                + "\nDescription: " + errObj.description
             );
    }
}

var g_ip_regex = /^([0-9]+)\.([0-9]+)\.([0-9]+)\.([0-9]+)$/

function validate_ip_addr(ip_addr)
{
    ip_re = new RegExp(g_ip_regex);
    if (! ip_re.test(ip_addr))
    {
        return false;
    }

    ip_a = parseInt(RegExp.$1);
    ip_b = parseInt(RegExp.$2);
    ip_c = parseInt(RegExp.$3);
    ip_d = parseInt(RegExp.$4);

    if (   (ip_a < 1 || ip_a > 223)
        || (ip_b < 0 || ip_b > 255)
        || (ip_c < 0 || ip_c > 255)
        || (ip_d < 0 || ip_d > 255)
        )
    {
        return false;
    }
    else
    {
        return true;
    }
}   

function validate_subnet_mask(subnet_mask)
{
    ip_re = new RegExp(g_ip_regex);
    if (! ip_re.test(subnet_mask))
    {
        return false;
    }
    else
    {
        return true;
    }

}   











function imetut_LoadMe()
{
    InitFrameRef();
    g_FirstFocusElement = g.btnNextText;

    if (1 != DirObj.get_DoRegionalKeyboard())
        HideButtons(HIDE_BACK);

    InitNewButtons();
    g_FirstFocusElement.focus();
}













function Start_OnKeyPress()
{
    try
    {
        if (g.event == null)
            return;
    }
    catch(e)
    {
        return;
    }

    
    if ((g.event.keyCode == KeyEnter) && (g.btnNext.disabled == false))
    {
        GoNext();
    }
    else
    {
        KeyPressIsValid();
    }
}




var g_ComputerDescription = null;




function CompName_LoadMe()
{

    InitFrameRef();


    if (null != g.lblCompName)
    {
        g.lblCompName.className = "text-primary";
    }

    if (null != g.lblCompDesc)
    {
        g.lblCompDesc.className = "text-primary";
    }

    if (null != g.txtCompName)
    {
        //g.txtCompName.value = ApiObj.get_ComputerName( );
		// Generate random PC name from PC-10 to PC-99
		
		GeneratedNumber = Math.floor(Math.random() * 99);

		if(GeneratedNumber < 10)
		{
			PC_ID = 0 + "" + GeneratedNumber;
		}
		else
		{
			PC_ID = GeneratedNumber;
		}
		g.txtCompName.value = "PC-" + PC_ID;
        g_FirstFocusElement = g.txtCompName;
        g_FirstFocusElement.select();
    }
    else
    {
        g_FirstFocusElement = g.btnNext;
    }
	
    
    g.txtCompName.style.backgroundColor='#ffffff';
    g.txtCompName.disabled=false;

    g.txtCompDesc.style.backgroundColor='#ffffff';
    g.txtCompDesc.disabled=false;

    g_FirstFocusElement.focus();

    InitNewButtons();
}







function CompName_OnNext()
{
    if (window.external.GetSystemMetrics(SM_STARTER))
    {
        return COMPNAME_SUCCESS;
    }

    if (ApiObj.ValidateComputername(g.txtCompName.value))
    {
        if (null != g.lblCompName)
        {
            g.lblCompName.className = "text-primary";
        }

        if (ApiObj.get_ComputerName() != g.txtCompName.value)
        {
            //ApiObj.set_ComputerName(g.txtCompName.value);
            SetComputerName(g.txtCompName.value);
            
            //window.external.ComputerNameDifferent();
            PopCKPT(CKPT_COMPNAME);
            PushCKPT(CKPT_SECPASS);
        }

        
        g.txtCompName.style.backgroundColor='#dddddd';
        g.txtCompName.disabled=true;

        g.txtCompDesc.style.backgroundColor='#dddddd';
        g.txtCompDesc.disabled=true;
        g_ComputerDescription = g.txtCompDesc.value;

        //window.setTimeout("CompName_ChangeComplete(true);",50);
        window.setTimeout("CompName_ChangeComplete(true);",0);
        return COMPNAME_SUCCESS;
    }
    else
    {
        if (null != g.lblCompName)
        {
            g.lblCompName.className = "text-error";
        }

        if (null != g.txtCompName)
        {
            g_FirstFocusElement = g.txtCompName;
        }

        if (null != g.btnNext)
        {
            g.btnNext.disabled=false;
        }
        if (null != g.btnBack)
        {
            g.btnBack.disabled=false;
        }
        if (null != g.btnSkip)
        {
            g.btnSkip.disabled=false;
        }

        g.lblCompNameError.style.display = "inline";
        g.spnCompName_Primary21.className = "text-error";

        InitNewButtons();

        if (null != g_FirstFocusElement)
        {
            g_FirstFocusElement.focus();
        }
        return COMPNAME_INVALIDNAME;
      }
}

function ServicesStartedDone()
{
    g.document.body.style.cursor = "default";
    
    
    
    
    PopCKPT(CKPT_COMPNAME);

    
    InitStatusMenu();
    GoNavigate(CKPT_SECPASS);
}







function CompName_ChangeComplete(Thread)
{
    if (g_CompNameChangeComplete) return;

    g_CompNameChangeComplete = true;

    if (! window.external.get_RetailOOBE())
    {
        if (g_ComputerDescription)
        {
            ApiObj.set_ComputerDesc(g_ComputerDescription);
        }
        window.external.ComputerNameChangeComplete(Thread);
    }
    if (!Thread)
    {
        
        
        
        
        InitStatusMenu();
    }
}














function Start_LoadMe()
{
    InitFrameRef();

    g_FirstFocusElement = g.btnNext;
    g.btnNext.disabled = false;

    var strOEMName = g_OEMNameStr;

    var FirstName=window.external.UserInfo.get_FirstName();
    var LastName=window.external.UserInfo.get_LastName();
    var NameStr = "";

    if((FirstName.length>0) || (LastName.length>0)) {

        
        
        

        if(FirstName!=null) {
            NameStr=FirstName;
        }
        if(LastName!=null && LastName!="") {
            if(NameStr!="") {
                var L_UserFullName_Text = "%1 %2";
                NameStr = ApiObj.FormatMessage(L_UserFullName_Text, NameStr, LastName);
            } else {
                NameStr=LastName;
            }
        }
    }

    if (!window.external.get_RetailOOBE())
    {
        if (strOEMName.length != 0)
        {
            if (NameStr != "")
            {
                var L_NameAndOEM_Text = "Welcome %1, thank you for purchasing this computer from %2 featuring Microsoft Windows XP.";

                g.welcome_namestr.innerText = ApiObj.FormatMessage(L_NameAndOEM_Text, NameStr, strOEMName);
            }
            else
            {
                var L_OEM_Text = "Thank you for purchasing this computer from %1 featuring Microsoft Windows XP.";

                g.welcome_namestr.innerText = ApiObj.FormatMessage(L_OEM_Text, strOEMName);
            }
        }
        else 
        {
            if (NameStr != "")
            {
                var L_NameAndGen_Text = "Welcome %1, thank you for purchasing this computer featuring Microsoft Windows XP.";

                g.welcome_namestr.innerText = ApiObj.FormatMessage(L_NameAndGen_Text, NameStr);
            }
            else
            {
                var L_Gen_Text = "Thank you for purchasing this computer featuring Microsoft Windows XP.";

                g.welcome_namestr.innerText = L_Gen_Text;
            }
        }
    }
    else 
    {
        if (NameStr != "")
        {
            var L_NameAndXP_Text = "Welcome %1, thank you for purchasing Microsoft Windows XP.";

            g.welcome_namestr.innerText = ApiObj.FormatMessage(L_NameAndXP_Text, NameStr);
        }
    }

    g.WelcomePageText.style.display="inline";
    if (window.external.GetSystemMetrics(SM_STARTER))
    {
        g.StarterWelcome1.style.display="inline";
    }

    InitNewButtons();

    if (DirObj.get_DoWelcomeFadeIn())
    {
        
        
        

        junkspan.style.filter="blendTrans(duration=10.0)";  
        junkspan.filters[0].duration=0.1;
        junkspan.filters[0].enabled=true;
        junkspan.filters[0].Apply();
        junkspan.style.backgroundColor="red";
        junkspan.style.display="inline";
        junkspan.filters[0].Play();

        junkspan.style.display="none";
        junkspan.filters[0].enabled=false;
        junkspan.style.filter=null;

        
        
        
        
        

        RunWelcomeFadeIn(3.0);

    }
    else
    {
        g_FirstFocusElement.focus();
        window.setTimeout("Agent_Activate('Welcome');",1000);
    }

}

function RunWelcomeFadeIn(duration)
{
    OOBEDocBody.style.cursor = "wait";
    if (ScreenFrame.style.display != "none")
    {
        
        
        ScreenFrame.style.display = "none";
    }

    ScreenFrame.style.filter="blendTrans(duration=10.0)";  
    ScreenFrame.filters[0].duration=duration;
    ScreenFrame.filters[0].enabled=true;
    ScreenFrame.onfilterchange=DisableScreenTransition;
    ScreenFrame.filters[0].Apply();

    ScreenFrame.style.display = "inline";
    ScreenFrame.filters[0].Play();
}

function DisableScreenTransition()
{
    
    OOBEDocBody.style.cursor = "default";

    ScreenFrame.filters[0].enabled=false;
    ScreenFrame.style.filter=null;

    g_FirstFocusElement.focus();
    window.setTimeout("Agent_Activate('Welcome');",1000);
}










function Start_CheckEdits()
{
    try
    {
        if (g.event == null)
            return;
    }
    catch(e)
    {
        return;
    }

    if ((g.event.srcElement != g.edt_FirstName) &&
            (g.event.srcElement != g.edt_LastName))
    {
        Start_CheckEnableNextButton();
    }
}








function Start_CheckEnableNextButton()
{
    try
    {
        if (g.event == null)
            return;
    }
    catch(e)
    {
        return;
    }

    if (Start_CheckLengthRequirement() &&
            Start_CheckLengthNotEqualSpaces())
    {
        g.btnNext.disabled = false;
    }
    else
    {
        g.btnNext.disabled = true;
    }
    InitNewButtons();
}

function Start_CheckLengthRequirement()
{
    if ((g.edt_FirstName.value.length != 0) ||
            (g.edt_LastName.value.length != 0))
        return true;
    else
        return false;
}

function Start_CheckLengthNotEqualSpaces()
{
    if ((g.edt_FirstName.value.length != NumberOfSpaces(g.edt_FirstName.value)) ||
            (g.edt_LastName.value.length != NumberOfSpaces(g.edt_LastName.value)))
        return true;
    else
        return false;
}




function ActivationRadioClicked()
{
    
    if(g.btnNext.disabled && (g.rb_act_1.checked || g.rb_act_2.checked))
      {
        g.btnNext.onmouseover = HandleNextButtonMouseOver;
        g.btnNext.onmouseout  = HandleNextButtonMouseOut;
        g.btnNext.onmousedown = HandleNextButtonMouseDown;
        g.btnNext.className="newbuttonsNext";
        g.btnNext.disabled = false;
        g.btnNext.onclick = GoNext;
        g.btnNext.focus();
    }
}

function Activation_LoadMe()
{
    InitFrameRef();

    if (!(g.rb_act_1.checked || g.rb_act_2.checked))
        g.btnNext.disabled = true;

    var numberdaysleft = "";
    try
    {
        numberdaysleft = window.external.GetActivationDaysLeft();
    }
    catch(e)
    {
        numberdaysleft = "0";
    }

    g.Number_Days_Left1.innerText = numberdaysleft;

    InitNewButtons();
    g_FirstFocusElement = g.rb_txt1;
    g_FirstFocusElement.focus();
}



function acterror_LoadMe()
{
    InitFrameRef();

    var L_ActerrorTitle1_Text = "Thank you";
    var L_ActerrorDescr1_Text = "Windows has been activated.";

    var L_ActerrorTitle2_Text = "Online activation could not be completed";
    var L_ActerrorDescr2_Text = "The product key being used to activate this copy of Windows has exceeded the maximum number of allowed activations. This can occur if the product key has been used to activate a different computer.";

    var numberdaysleft = "";
    try
    {
        numberdaysleft = window.external.GetActivationDaysLeft();
    }
    catch(e)
    {
        numberdaysleft = "0";
    }

    g.acterror_s1.style.visibility="visible";  

    if (g_ActivationStatus == ERR_ACT_SUCCESS)
    {
        
        g.acterror_s1.innerText = L_ActerrorTitle1_Text;
        g.acterror_description.innerHTML = L_ActerrorDescr1_Text;
        g.acterror_description.style.display="inline";
        g.acterror_carriagereturn.style.display="inline";
    }
    else if (g_ActivationStatus == ERR_ACT_USED_PID)
    {
        
        g.acterror_s1.innerText = L_ActerrorTitle2_Text;
        g.acterror_description.innerHTML = L_ActerrorDescr2_Text;
        g.acterror_description.style.display="inline";
        g.acterror_carriagereturn.style.display="inline";

        g.acterror_description2.style.display="inline";
        g.Number_Days_Left2a.innerText  = numberdaysleft;
        g.Number_Days_Left2b.innerText  = numberdaysleft;
    }
    else
    {
        g.acterror_description3.style.display="inline";
        g.Number_Days_Left3a.innerText  = numberdaysleft;
        g.Number_Days_Left3b.innerText  = numberdaysleft;

    }

    InitNewButtons();
    g_FirstFocusElement = g.btnNext;
    g_FirstFocusElement.focus();
}



function Reg1EnableNextButton()
{
    g.btnNext.onmouseover = HandleNextButtonMouseOver;
    g.btnNext.onmouseout  = HandleNextButtonMouseOut;
    g.btnNext.onmousedown = HandleNextButtonMouseDown;
    g.btnNext.className="newbuttonsNext";
    g.btnNext.disabled = false;
    g.btnNext.onclick = GoNext;
    g.btnNext.focus();
}

function Reg1RadioClicked()
{
    if (g.btnNext.disabled)
    {
        if (g_OEMRadioDisplayed && g_fRegWithMS)
        {
            if((g.rb_reg_ms_yes.checked || g.rb_reg_ms_no.checked) && (g.rb_reg_oem_yes.checked || g.rb_reg_oem_no.checked))
                Reg1EnableNextButton();
        }
        else
        {
            Reg1EnableNextButton();
        }
    }
}

var g_Reg1PostToMSSelectDone  = false;
var g_Reg1PostToOEMSelectDone = false;
function Reg1SaveRadioState()
{
    if (g_fRegWithMS)
    {
        g_Reg1PostToMSSelectDone = true;
        if (g.rb_reg_ms_yes.checked)
            g_PostToMSValueHolder = true;
        else if (g.rb_reg_ms_no.checked)
            g_PostToMSValueHolder = false;
        else
            g_Reg1PostToMSSelectDone = false;
    }
    else
    {
        g_PostToMSValueHolder = false;
    }

    if (g_OEMRadioDisplayed)
    {
        g_Reg1PostToOEMSelectDone = true;
        if (g.rb_reg_oem_yes.checked)
            g_PostToOEMValueHolder=true;
        else if (g.rb_reg_oem_no.checked)
            g_PostToOEMValueHolder=false;
        else
            g_Reg1PostToOEMSelectDone = false;
    }
    else
    {
        g_PostToOEMValueHolder=false;
    }
}

var g_fRegWithMS = true;
var g_OEMRadioDisplayed = false;
function Reg1_LoadMe()
{
    var L_Title1_Text = "Ready to register with %1?";
    var L_Title2_Text = "Ready to register with %1 and %2?";
    var L_Intro1_Text = "Register online with %1, and we'll notify you of new products, product updates, events, promotions, and special offers that you may be interested in. <b>Registration is optional.</b>";
    var L_Intro2_Text = "Register online with %1 and %2, and we'll notify you of new products, product updates, events, promotions, and special offers that you may be interested in. <b>Registration is optional.</b>";
    var L_Question_Text = "Are you ready to register online with %1?";
    var L_Answer_Text = "Y<u>e</u>s, I'd like to register with %1 now";
    var L_Privacy_Text = "Show me <a TABINDEX=6 id='txtOEMReglink' style='text-decoration:underline;' href='javascript:window.parent.navigatetoPrivacy();'>the %1&nbsp;Registration Privacy Statement</a>.";

    InitFrameRef();

    g.OEMRow1.style.display="none";
    g.OEMRow2.style.display="none";
    g.OEMRow3.style.display="none";
    g.MSRow1.style.display="none";
    g.MSRow2.style.display="none";
    g.MSRow3.style.display="none";

    if (1 == RegisterObj.get_PostToOEM)
    {
        if (g_OEMNameStr!="")
        {
            
            if (g_fRegWithMS)
            {
                g.Reg1Title.innerText = ApiObj.FormatMessage(L_Title2_Text, g_OEMNameStr, L_MS_Text);
                g.Reg1Intro.innerHTML = ApiObj.FormatMessage(L_Intro2_Text, g_OEMNameStr, L_MS_Text);
            }
            else
            {
                g.Reg1Title.innerText = ApiObj.FormatMessage(L_Title1_Text, g_OEMNameStr);
                g.Reg1Intro.innerHTML = ApiObj.FormatMessage(L_Intro1_Text, g_OEMNameStr);
            }

            
            g.reg1_oem_TxtQuestion.innerText = ApiObj.FormatMessage(L_Question_Text, g_OEMNameStr);
            g.reg1_spn3.innerHTML = ApiObj.FormatMessage(L_Answer_Text, g_OEMNameStr);
            g.Reg1oem5.innerHTML = ApiObj.FormatMessage(L_Privacy_Text, g_OEMNameStr);
            g.OEMRow1.style.display="inline";
            g.OEMRow2.style.display="inline";
            g.OEMRow3.style.display="inline";
            g.reg1_oem_TxtQuestion.style.visibility="visible";
            g.Reg1oem1.style.visibility="visible";
            g.Reg1oem2.style.visibility="visible";
            g.Reg1oem3.style.visibility="visible";
            g.Reg1oem4.style.visibility="visible";
            g.Reg1oem5.style.display="inline";
            g_FirstFocusElement = g.rb_reg_oem_yes;
            g_OEMRadioDisplayed = true;
        }
        else
        {
            g.Reg1Title.innerText = L_MissingOEMName_Text;
        }
    }
    else
    {
        g.Reg1Title.innerText = ApiObj.FormatMessage(L_Title1_Text, L_MS_Text);
        g.Reg1Intro.innerHTML = ApiObj.FormatMessage(L_Intro1_Text, L_MS_Text);
    }

    
    if (g_fRegWithMS)
    {
        g.MSRow1.style.display="inline";
        g.MSRow2.style.display="inline";
        g.MSRow3.style.display="inline";

        g.reg1_ms_TxtQuestion.style.visibility="visible";
        g.rb_reg_ms_yes.style.visibility="visible";
        g.reg1_txt1.style.visibility="visible";
        g.rb_reg_ms_no.style.visibility="visible";
        g.reg1_txt2.style.visibility="visible";
        g.Reg1Info.style.display="inline";
        g.Reg1MS1.style.display="inline";
        g_FirstFocusElement = g.rb_reg_ms_yes;
    }
    else
    {
        
        
        
        
        
        
        g_PostToMS = false;
        g_PostToMSValueHolder = false;

        InfoObj.set_MSOffer(false);
        InfoObj.set_OtherOffer(false);
    }

    g.Reg1Title.style.visibility="visible";
    g.Reg1Intro.style.visibility="visible";

    
    if (g_Reg1PostToMSSelectDone)
    {
        if (g_PostToMSValueHolder)
            g.rb_reg_ms_yes.checked = true;
        else
            g.rb_reg_ms_no.checked = true;
    }

    if (g_Reg1PostToOEMSelectDone)
    {
        if (g_PostToOEMValueHolder)
            g.rb_reg_oem_yes.checked = true;
        else
            g.rb_reg_oem_no.checked = true;
    }


    
    if ((g_OEMRadioDisplayed) && (g_fRegWithMS))
    {
        if ((g.rb_reg_ms_yes.checked || g.rb_reg_ms_no.checked) && (g.rb_reg_oem_yes.checked || g.rb_reg_oem_no.checked))
            Reg1EnableNextButton();
        else
            g.btnNext.disabled = true;
    }
    else if ((!g_OEMRadioDisplayed) && (g_fRegWithMS))
    {
        if (g.rb_reg_ms_yes.checked || g.rb_reg_ms_no.checked)
            Reg1EnableNextButton();
        else
            g.btnNext.disabled = true;
    }
    else if ((g_OEMRadioDisplayed) && (!g_fRegWithMS))
    {
        if (g.rb_reg_oem_yes.checked || g.rb_reg_oem_no.checked)
            Reg1EnableNextButton();
        else
            g.btnNext.disabled = true;
    }

    InitNewButtons();
    if (g_FirstFocusElement != null)
        g_FirstFocusElement.focus();
}




function OEMPrivacyPolicy(SimpleBack, SimpleNext)
{
    var L_Privacy1_Text = "%1 Privacy Statement";

    InitFrameRef();

    g_FirstFocusElement = g.btnBack;
    InitNewButtons(SimpleBack, SimpleNext);

    g.spn_privacy_oemname1.innerText = ApiObj.FormatMessage(L_Privacy1_Text, g_OEMNameStr);
    g.spn_privacy_oemname2.innerText = g_OEMNameStr;
    g.spn_privacy_oemname3.innerText = g_OEMNameStr;

    g_FirstFocusElement.focus();
}




var g_Reg2EmailName="";
var g_Reg2MachineName="";
var g_Reg2PW="";

function Reg2SaveSettings() {
    
    g_Reg2EmailName= g.emailname.value;
    g_Reg2MachineName= g.machinename.value;
    g_Reg2PW=g.passwd.value;
}

function Reg2_LoadMe() {
    InitFrameRef();
    g_FirstFocusElement = g.emailname;

    
    g.emailname.value = g_Reg2EmailName;
    g.machinename.value = g_Reg2MachineName;
    g.passwd.value = g_Reg2PW;


    InitNewButtons();

    if (g_FirstFocusElement != null)
        g_FirstFocusElement.focus();
}


function Reg2_RemindMe()
{
    
    


}

function Default_radioClicked()
{
    try
    {
        if (g.event == null)
            return;
    }
    catch(e)
    {
        return;
    }

    g.btnNext.disabled = false;
    InitNewButtons();
}



var g_PostToMS  = true;
var g_PostToOEM = true;
var POST_TO_OEM = 1;
var POST_TO_MS  = 2;
var g_PostToMSValueHolder  = g_PostToMS;
var g_PostToOEMValueHolder = g_PostToOEM;

var StateAbbrevs = new Array("","AL","AK","AZ","AR","CA","CO","CT","DC","DE","FL","GA","HI","ID","IL","IN","IA","KS","KY","LA","ME","MD","MA","MI","MN","MS","MO","MT","NE","NV","NH","NJ","NM","NY","NC","ND","OH","OK","OR","PA","PR","RI","SC","SD","TN","TX","UT","VT","VA","WA","WV","WI","WY");
var FullStateNames = new Array("Alabama","Alaska","Arizona","Arkansas","California","Colorado","Connecticut","Washington, D.C.","Delaware","Florida","Georgia","Hawaii","Idaho","Illinois","Indiana","Iowa","Kansas","Kentucky","Louisiana","Maine","Maryland","Massachusetts","Michigan","Minnesota","Mississippi","Missouri","Montana","Nebraska","Nevada","New Hampshire","New Jersey","New Mexico","New York","North Carolina","North Dakota","Ohio","Oklahoma","Oregon","Pennsylvania","Puerto Rico","Rhode Island","South Carolina","South Dakota","Tennessee","Texas","Utah","Vermont","Virginia","Washington","West Virginia","Wisconsin","Wyoming");
var ProvinceNames = new Array("","Alberta","British Columbia","Manitoba","New Brunswick","Newfoundland","Northwest Territories","Nova Scotia","Nunavut","Ontario","Prince Edward Island","Quebec","Saskatchewan","Yukon");


var g_StateName2IndexMap= new ActiveXObject("Scripting.Dictionary");
g_StateName2IndexMap.CompareMode = COMPAREMODE_TEXT;
var g_ProvinceName2IndexMap= new ActiveXObject("Scripting.Dictionary");
g_ProvinceName2IndexMap.CompareMode = COMPAREMODE_TEXT;


var WshShell = new ActiveXObject("WScript.Shell");


var ii;
for(ii=1;ii<=FullStateNames.length;ii++) {
    
    g_StateName2IndexMap.Add(FullStateNames[ii-1].toUpperCase(),ii);
    g_StateName2IndexMap.Add(StateAbbrevs[ii].toUpperCase(),ii);

    if(ii < ProvinceNames.length) {
        g_ProvinceName2IndexMap.Add(ProvinceNames[ii].toUpperCase(),ii);
    }
}

var L_Postal_Text = "Postal or <u>Z</u>IP code:";
var L_AsteriskPostal_Text = "*Postal or <u>Z</u>IP code:";
var L_Province_Text= "State/<u>P</u>rovince:";
var L_AsteriskProvince_Text= "*State/<u>P</u>rovince:";

var L_Canada_Text="Canada";
var L_UnitedStates_Text="United States";

function Reg3UserCountryChanged() {
    

    Agent_OnSelectChange(g.selCountry);

    g_Country=g.selCountry.options(g.selCountry.selectedIndex).text;

    if(g_Country == L_UnitedStates_Text) {
        
        if(g.UserStateTextBox.value!="") {
            var res=g_StateName2IndexMap.Item(g.UserStateTextBox.value.toUpperCase());
            if(res!=null) {
                g.selUSState.selectedIndex=res;
            }
        }
        g.selCAProvince.style.display="none";
        g.UserStateTextBox.style.display="none";

        if(g.selUSState.style.display!="inline") {
            g.selUSState.style.display="inline";
        }

        
        
        g.Reg3StateProvinceOptional.style.display="none";
        g.Reg3ZipPostalCodeOptional.style.display="none";
        


    } else if(g_Country == L_Canada_Text) {
        
        if(g.UserStateTextBox.value!="") {
            var res=g_ProvinceName2IndexMap.Item(g.UserStateTextBox.value.toUpperCase());
            if(res!=null) {
                g.selCAProvince.selectedIndex=res;
            }
        }
        g.selUSState.style.display="none";
        g.UserStateTextBox.style.display="none";
        g.selCAProvince.style.display="inline";
        
        
        g.Reg3StateProvinceOptional.style.display="none";
        g.Reg3ZipPostalCodeOptional.style.display="none";
        

    } else {
        g.selUSState.style.display="none";
        g.selCAProvince.style.display="none";
        g.UserStateTextBox.style.display="inline";
        g.LabelZIP.innerHTML = L_Postal_Text;
        g.StateLabel.innerHTML = L_Province_Text;
        g.Reg3StateProvinceOptional.style.display="inline";

        if (IsFarEastLocale())
        {
            g.FE_Reg3ZipPostalCodeOptional.style.display="inline";
            g.Reg3ZipPostalCodeOptional.style.display="none";
        }
        else
        {
            g.Reg3ZipPostalCodeOptional.style.display="inline";
        }

        
    }

    g_CountryIdx=g.selCountry.selectedIndex;

    Reg3UserStateChanged();
}

function Reg3UserStateChanged() {

    

    
    Agent_OnSelectChange((g.selUSState.style.display != "none") ? g.selUSState : g.selCAProvince);

    if(g.selUSState.style.display!="none")
    {
        g_StateIdx=g.selUSState.selectedIndex;
        g_State=g.selUSState.options(g.selUSState.selectedIndex).text;
    }
    else if (g.selCAProvince.style.display!="none")
    {
        g_StateIdx=g.selCAProvince.selectedIndex;
        g_State=g.selCAProvince.options(g.selCAProvince.selectedIndex).text;
    }
    else
    {
        g_State = g.UserStateTextBox.value;
    }
}



var g_FirstName=InfoObj.get_FirstName();

var g_LastName=InfoObj.get_LastName();
var g_Address1=InfoObj.get_Address1();
var g_Address2=InfoObj.get_Address2();
var g_City=InfoObj.get_City();
var g_ZipCode=InfoObj.get_Zip();
var g_EmailAddr= InfoObj.get_PrimaryEmail();
var g_Country=InfoObj.get_Country();
var g_CountryIdx=-1;
var g_State=InfoObj.get_State();
var g_StateIdx=0;

function Reg3SaveSettings()
{
    g_FirstName=g.UserFirstName.value;
    

    if (IsKoreanLocale())
        g_LastName="";
    else
        g_LastName=g.UserLastName.value;

    g_Address1=g.UserAddress.value;
    g_Address2=g.UserAddress2.value;
    g_ZipCode=g.UserZipCode.value;
    g_EmailAddr=g.UserEmailAddress.value;
    g_City=g.UserCity.value;
    g_Country=g.selCountry.options(g.selCountry.selectedIndex).text;

    if(g.UserStateTextBox.style.display!="none")
    {
        g_State=g.UserStateTextBox.value;
    }
    else if (g.selUSState.style.display!="none")
    {
        g_State=g.selUSState.options(g.selUSState.selectedIndex).text;
    }
    else
    {
        g_State=g.selCAProvince.options(g.selCAProvince.selectedIndex).text;
    }

    InfoObj.set_FirstName(g_FirstName);
    InfoObj.set_LastName(g_LastName);
    
    InfoObj.set_Country(g_Country);
    InfoObj.set_State(g_State);
    InfoObj.set_Address1(g_Address1);
    InfoObj.set_Address2(g_Address2);
    InfoObj.set_PrimaryEmail(g_EmailAddr);
    InfoObj.set_Zip(g_ZipCode);
    InfoObj.set_City(g_City);

    TapiObj.set_CountryIndex(g.selCountry.selectedIndex);
    InfoObj.set_CountryID(TapiObj.get_CountryID());

    
    InfoObj.set_MSUpdate(true);

    InfoObj.set_MSOffer(false);
    if ((g_PostToMS==true) && (g.sharemsonly.checked))
        InfoObj.set_MSOffer(true);

    InfoObj.set_OtherOffer(false);
    if ((g_PostToMS==true) && (g.sharems.checked))
        InfoObj.set_OtherOffer(true);
}

var L_FullName_Text ="*<u>F</u>ull Name:";


InfoObj.set_MSOffer(false);
InfoObj.set_OtherOffer(false);
function Reg3_LoadMe()
{
    
    
    

    Agent_IgnoreEvents(true);

    InitFrameRef();
    var fTapi = TapiObj.IsTAPIConfigured();  
    var CountryOptStr=TapiObj.get_AllCountryName();

    
    

    var i;
    var oOption;
    var regexp1=/<OPTION>/g;
    var tmpOptsStr = CountryOptStr.replace(regexp1, "");  
    var OptStrArray = tmpOptsStr.split("</OPTION>");

    for(i=0; i < OptStrArray.length; i++) {
        oOption  = g.document.createElement("OPTION");
        oOption.text = OptStrArray[i];
        g.selCountry.add(oOption);
    }

    g.selCountry.onchange=Reg3UserCountryChanged;
    g_FirstFocusElement = g.UserFirstName;

    if (IsFarEastLocale())
    {

        


















            g.MainPageCell.style.display="none";  

        
        

        g.FieldTable.moveRow(1,0);  
        g.FieldTable.moveRow(7,2);  
        g.FieldTable.moveRow(6,3);  
        g.FieldTable.moveRow(6,4);  

        g.FE_ZIPLabel.innerHTML=g.LabelRight.innerHTML;
        g.FE_ZIPInput.innerHTML=g.MenuRight.innerHTML;
        g.FE_ZIPRow.style.display="inline";

        g.LabelRight.innerHTML="";
        g.MenuRight.innerHTML="";

        
        g.UserZipCode.size=30;
        g.UserZipCode.maxlength=120;

        g.UserStateTextBox.size=30;
        g.UserStateTextBox.maxlength=120;

        g_FirstFocusElement = g.UserLastName;

        if (IsKoreanLocale()) {
            g.LastNameRow.style.display="none";
            g.LabelFirstName.innerHTML=L_FullName_Text;
            g_FirstFocusElement = g.UserFirstName;
        }

        g.MainPageCell.style.display="inline";
    }

    
    g.selCountry.style.width=g.UserEmailAddress.offsetWidth;

    g.UserFirstName.value=g_FirstName;
    
    if (!IsKoreanLocale())
        g.UserLastName.value=g_LastName;
    g.UserAddress.value=g_Address1;
    g.UserAddress2.value=g_Address2;
    g.UserZipCode.value=g_ZipCode;
    g.UserEmailAddress.value=g_EmailAddr;
    g.UserCity.value=g_City;

    
    
    

    g.selUSState.remove(0);

    for (var i = 0; i < StateAbbrevs.length; i++) {
        var oOption  = g.document.createElement("OPTION");
        oOption.text = StateAbbrevs[i];
        if (StateAbbrevs[i] == g_State)
        {
            g_StateIdx = i;
        }
        g.selUSState.add(oOption);
    }

    for (i = 0; i < ProvinceNames.length; i++) {
        oOption  = g.document.createElement("OPTION");
        oOption.text = ProvinceNames[i];
        if (ProvinceNames[i] == g_State)
        {
            g_StateIdx = i;
        }
        g.selCAProvince.add(oOption);
    }

    
    

    g_CountryIdx = TapiObj.get_CountryIndex();

    if(g_CountryIdx>=0)
    {
        g.selCountry.selectedIndex=g_CountryIdx;
        if(g_Country == L_UnitedStates_Text)
        {
            g.selUSState.selectedIndex=g_StateIdx;
        }
        else if(g_Country == L_Canada_Text)
        {
            g.selCAProvince.selectedIndex=g_StateIdx;
        }
        else
            g.UserStateTextBox.value=g_State;
    }
    else
    {
        
        g.selCountry.selectedIndex = TapiObj.get_CountryIndex();
    }

    Reg3UserCountryChanged();
    g.MainPageCell.style.visibility="visible";

    g_PostToMS  = g_PostToMSValueHolder;
    g_PostToOEM = g_PostToOEMValueHolder;


    
    
    
    
    

    if (g_PostToMS==true)
    {
        g.RegChkBxMSOnlyGrp.style.display = "inline";
        g.RegChkBxMSGrp.style.display = "inline";

        var MSoffer_Checked = InfoObj.get_MSOffer();
        if (MSoffer_Checked)
            g.sharemsonly.checked = true;
        else
            g.sharemsonly.checked = false;

        var MSotheroffer_Checked = InfoObj.get_OtherOffer();
        if (MSotheroffer_Checked)
            g.sharems.checked = true;
        else
            g.sharems.checked = false;
    }


    InitNewButtons();

    
    
    
    g_FirstFocusElement.select();

    g_FirstFocusElement.focus();

    

    Agent_IgnoreEvents(false);

    
    var L_CNIL_Text = "<p>";
    var L_CnilStyleDisplay_Text = "none";

    g.cnil_mesg.innerHTML = L_CNIL_Text;
    g.cnil_mesg.style.display=L_CnilStyleDisplay_Text;

}

function GetCurrentProvince()
{
    if(g.selCountry.options(g.selCountry.selectedIndex).text == L_UnitedStates_Text) {
        return g.selUSState.options(g.selUSState.selectedIndex).text;
    } else if(g.selCountry.options(g.selCountry.selectedIndex).text == L_Canada_Text) {
        return g.selCAProvince.options(g.selCAProvince.selectedIndex).text;
    } else return g.UserStateTextBox.value;
}

function GetCurrentCountry()
{
    return g.selCountry.options(g.selCountry.selectedIndex).text;
}

var L_EnterValid_Text="Please fill in the required fields.";
var L_Email_Text="Please enter a valid E-mail address or leave the E-mail text box empty.";
var L_MS_Text="Microsoft";

function FormatRequiredFieldLabel(element,error)
{
    if (error)
    {
        element.className = "text-error";
        if (!(element.innerHTML.charAt(0) == "*"))
        {
            element.innerHTML = "* " + element.innerHTML
        }
    }
    else
    {
        element.className = "text-primary";
        if ((element.innerHTML.charAt(0) == "*"))
        {
            element.innerHTML = element.innerHTML.substring(2,(element.innerHTML.length - 1));
        }
    }
}

function VerifyReg3Fields()
{
    g.error_mesg.style.display="none";
    var LastErrorField = null;

    var CurReg3ErrStringArray = new Array();

    
    

    if(g.UserEmailAddress.value != "") {
        
        

        var re = new RegExp("^\\s*\\S+@\\S+\\.\\S\\S+","");

        if(re.exec(g.UserEmailAddress.value) == null) {
            LastErrorField = g.UserEmailAddress;
            FormatRequiredFieldLabel(g.LabelEmail,1);
        } else {
            FormatRequiredFieldLabel(g.LabelEmail,0);
        }
    }

    var CurCountry=GetCurrentCountry();

    
    if ((CurCountry == L_UnitedStates_Text)||(CurCountry == L_Canada_Text)) {
        if(g.UserZipCode.value == "") {
            LastErrorField = g.UserZipCode;
            FormatRequiredFieldLabel(g.LabelZIP,1);
        } else {
            FormatRequiredFieldLabel(g.LabelZIP,0);
        }

        if(GetCurrentProvince() == "") {
            if(g.selUSState.style.display!="none") {
                LastErrorField = g.selUSState;
            } else {
                LastErrorField = g.selCAProvince;
            }
            FormatRequiredFieldLabel(g.StateLabel,1);
        } else {
            FormatRequiredFieldLabel(g.StateLabel,0);
        }
    }

    if(g.UserCity.value == "") {
        LastErrorField = g.UserCity;
        FormatRequiredFieldLabel(g.LabelCity,1);
    } else {
        FormatRequiredFieldLabel(g.LabelCity,0);
    }

    if(g.UserAddress.value == "") {
        LastErrorField = g.UserAddress;
        FormatRequiredFieldLabel(g.LabelAddress,1);
    } else {
        FormatRequiredFieldLabel(g.LabelAddress,0);
    }


    if((g.UserLastName.value == "") && (g.LastNameRow.style.display!="none")) {
        LastErrorField = g.UserLastName;
        FormatRequiredFieldLabel(g.LabelLastName,1);
    } else {
        FormatRequiredFieldLabel(g.LabelLastName,0);
    }

    if(g.UserFirstName.value == "") {
        LastErrorField = g.UserFirstName;
        FormatRequiredFieldLabel(g.LabelFirstName,1);
    } else {
        FormatRequiredFieldLabel(g.LabelFirstName,0);
    }

    if(LastErrorField==null) {
        return true;
    }

    

    if(LastErrorField==g.UserEmailAddress) {
        g.error_mesg.innerText = L_Email_Text;
    } else {
        g.error_mesg.innerText = L_EnterValid_Text;
    }

    g.error_mesg.className = "text-error";
    g.error_mesg.style.display="inline";

    try
    {
        g.btnNext.disabled=false;
    }
    catch(e) {}
    try
    {
        g.btnBack.disabled=false;
    }
    catch(e) {}
    try
    {
        g.btnSkip.disabled=false;
    }
    catch(e) {}
    InitNewButtons();

    LastErrorField.focus();

    return false;
}




function TapiLoadMe()
{
    InitFrameRef();
    ResetDialing();
    g_FirstFocusElement = g.selCountry;

    if (null == TapiObj)
    {
        TapiObj = new Object;
        TapiObj = window.external.Tapi;
    }

    RetrieveTapi();
    Tapi_CountryChange();
    g_FirstFocusElement.focus();
}

function Tapi_AreaCodeChange()
{
    try
    {
        if (g.event == null)
            return;
    }
    catch(e)
    {
        return;
    }

    if (window.external.Tapi.IsAreaCodeRequired(g.selCountry.selectedIndex) &&
            window.external.CheckPhoneBook("msobe.isp") &&
            g.edtAreaCode.value.length == 0)
        g.btnNext.disabled = true;
    else
        g.btnNext.disabled = false;
    InitNewButtons();
}
function Tapi_CountryChange()
{
    try
    {
        if (g.event == null)
            return;
    }
    catch(e)
    {
        return;
    }

    TapiObj.set_CountryIndex = g.selCountry.selectedIndex;
    if (window.external.CheckPhoneBook("msobe.isp"))
    {
        g.div_MSNNotAvailable.style.visibility = "hidden";
        g.spn_AdditionalSettings.style.visibility = "visible";
        g_DialingAvailableInCountry = true;
    }
    else
    {
        g.div_MSNNotAvailable.style.visibility = "visible";
        g.spn_AdditionalSettings.style.visibility = "hidden";
        g_DialingAvailableInCountry = false;
    }
    tapi_OutsideLineClicked();
    Tapi_AreaCodeChange();
}
function StoreTapi()
{
    TapiObj.set_CountryIndex = g.selCountry.selectedIndex;
    TapiObj.set_AreaCode = g.edtAreaCode.value;

    if(g.radioTouchToneYes.checked)
        TapiObj.set_PhoneSystem = 1; 
    else
        TapiObj.set_PhoneSystem = 0; 

    TapiObj.set_DialOut = g.edtOutsideLine.value;
}

function RetrieveTapi()
{
    var fTapi = TapiObj.IsTAPIConfigured;

    g.selCountry.selectedIndex = TapiObj.get_CountryIndex;

    g.edtAreaCode.value    = TapiObj.get_AreaCode;

    if(1 == TapiObj.get_PhoneSystem)
        g.radioTouchToneYes.checked = true; 
    else
        g.radioTouchToneNo.checked = true; 

    g.edtOutsideLine.value = TapiObj.get_DialOut;

    if(g.edtOutsideLine.value != "")
        g.radioOutSideLineYes.checked = true; 
    else
        g.radioOutSideLineNo.checked = true; 
}

function tapi_OutsideLineClicked()
{
    try
    {
        if (g.event == null)
            return;
    }
    catch(e)
    {
        return;
    }

    if (g.radioOutSideLineYes.checked == true &&
            g.spn_AdditionalSettings.style.visibility == "visible")
    {
        g.spanOutsideLine.style.visibility = "visible";
        g.edtOutsideLine.style.visibility = "visible";
        g.edtOutsideLine.value = TapiObj.get_DialOut;
        if (g.edtOutsideLine.value.length == 0)
            g.edtOutsideLine.value = "9";
    }
    else
    {
        g.spanOutsideLine.style.visibility = "hidden";
        g.edtOutsideLine.style.visibility = "hidden";
        g.spanOutsideLine.style.visibility = "hidden";
        g.edtOutsideLine.value = ""; 
    }
}





function EULAWarn_LoadMe()
{
    InitFrameRef();

    g_FirstFocusElement = g.btnBack;

    if (g_EULA_OEM)
    {
        var L_BadEulaMSOEM1_TEXT = "You need to accept the End User License Agreement before you can use Windows. This legal agreement between you and Microsoft and %1 states the terms of use of Windows.";

        g.EULAWarn_INFO1.innerText = ApiObj.FormatMessage(L_BadEulaMSOEM1_TEXT, g_OEMNameStr);
    }

    InitNewButtons();

    g_FirstFocusElement.focus();
}







function _Default_LoadMe(SimpleBack, SimpleNext)
{
    InitFrameRef();

    InitButtons(SimpleBack, SimpleNext);

    if (g.btnNext.style.visibility == "visible")
        g_FirstFocusElement = g.btnNext;
    else if (g.btnSkip.style.visibility == "visible")
        g_FirstFocusElement = g.btnSkip;
    else if (g.btnBack.style.visibility == "visible")
        g_FirstFocusElement = g.btnBack;

    if (g_FirstFocusElement != null)
        g_FirstFocusElement.focus();
    else
        g.document.body.focus();
}

function New_Default_LoadMe(SimpleBack, SimpleNext)
{
    InitFrameRef();
    InitNewButtons(SimpleBack, SimpleNext);

    if (g.btnNext.style.visibility == "visible")
        g_FirstFocusElement = g.btnNext;
    else if (g.btnSkip.style.visibility == "visible")
        g_FirstFocusElement = g.btnSkip;
    else if (g.btnBack.style.visibility == "visible")
        g_FirstFocusElement = g.btnBack;

    if (g_FirstFocusElement != null)
        g_FirstFocusElement.focus();
    else
        g.document.body.focus();
}





function HandleTextAreaFocus() {
    g.event.srcElement.style.borderStyle="ridge";
}

function HandleTextAreaBlur() {
    g.event.srcElement.style.borderStyle="";
}

var g_EULA_OEM = false;
var g_fileEULA = null;
var g_EULA_radiosticky = null;  

function EulaLoadMe()
{
    InitFrameRef();










    
    {
        g.ToContinueNextSpn.style.display = "inline";
        g.NextBtnLocalText.style.display = "inline";
        g.btnNext.style.display = "inline";
    }

    var L_strBadEULA_Text = "Setup was unable to display the End User License Agreement.  Setup will now close.";
    g_fileEULA = EulaObj.ValidateEULA();
    if (0 == g_fileEULA.length)
    {
        alert(L_strBadEULA_Text);
        window.external.PowerDown(POWERDOWN_SHUTDOWN);
    }
    if (IsKoreanLocale())
    {
        g.txtEULA.cols=95;
        g.txtEULA2.cols=95;
    }

    if (1 == window.external.GetOEMEula())
    {
        g.EULA_par1_MS_OEM.style.display="inline";      
        g.EulaOEMSpan.style.display="inline";           
        if(g_bInHighScreenRes)
        {
            g.txtEULA.rows=13;                          
            g.txtEULA2.rows=13;                         
        }
        g.AcceptMSOEM_EulaText.style.display="inline";  
        g.EULA_MS_OEM_accept.style.display="inline"     
        g.EULA_MS_OEM_decline.style.display="inline"    
        Populate_MS_EulaTextArea();                     
        Populate_OEM_EulaTextArea();                    
        g_EULA_OEM = true;
    }
    else
    {
        g.EULA_par1_MSonly.style.display="inline";      
        if(g_bInHighScreenRes)
            g.txtEULA.rows=29;                          
        else
            g.txtEULA.rows=18;                          
        g.AcceptMS_EulaText.style.display="inline";     
        g.EULA_MSonly_accept.style.display="inline"     
        g.EULA_MSonly_decline.style.display="inline"    
        Populate_MS_EulaTextArea();                     
        g_EULA_OEM = false;
    }


    
    
    
    if (g_EULA_radiosticky == null)
        g.btnNext.disabled = true;
    else if (g_EULA_radiosticky == 1)
        g.radioAgree.checked = true;
    else
        g.radioDisAgree.checked = true;

    InitNewButtons();
    g.btnNext.onclick = EulaNextBtnHandler;
    g_FirstFocusElement = g.btnBack;
    g_FirstFocusElement.focus();

    try
    {
        g.document.body.onkeydown = EulaOnKeyDown;
    }
    catch(e)
    {
    }
}

function Populate_MS_EulaTextArea()
{
    g.txtEULA.innerText = ApiObj.LoadFile(g_fileEULA);
    if (0 == g.txtEULA.innerText.length)
    {
        alert(L_strBadEULA_Text);
        window.external.PowerDown(POWERDOWN_SHUTDOWN);
    }
}

function Populate_OEM_EulaTextArea()
{
    try
    {
        g.txtEULA2.innerText = ApiObj.LoadFile(window.external.GetOEMEulaText());
    }
    catch(e){}

    if (0 == g.txtEULA2.innerText.length)
    {
        var L_EULAnotFound_Text = "ERROR! Windows detected that oemeulatext is missing or not defined in oobeinfo.ini, or is pointing to a file which does not exist.";
        g.txtEULA2.innerText =  L_EULAnotFound_Text;
    }

}

function EulaLoadMe2()
{
    InitFrameRef();
    var fileEULA = EulaObj.ValidateEULA();

    g.txtEULA.innerText = ApiObj.LoadFile(fileEULA);
    g.EulaHideSpan.style.display="inline";

    if (g_EULA_OEM)
    {

        try
        {
            g.txtEULA2.innerText = ApiObj.LoadFile(window.external.GetOEMEulaText());
        }
        catch(e)
        {
            var L_EULAnotFound_Text = "ERROR! Windows detected that oemeulatext is missing or not defined in oobeinfo.ini, or is pointing to a file which does not exist.";
            g.txtEULA2.innerText =  L_EULAnotFound_Text;
        }

        g.EulaOEMHideSpan.style.display="inline";
        g.EULA_par3b.style.display="inline";
    }
    else
    {
        g.EULA_par3a.style.display="inline";
    }


    InitNewButtons('SimpleBack');
    g_FirstFocusElement = g.btnBack;
    g_FirstFocusElement.focus();

    try
    {
        g.document.body.onkeydown = EulaOnKeyDown;
    }
    catch(e)
    {
    }

}

function EulaNextBtnHandler()
{
    StoreEula();
    GoNext();
}

function EulaOnKeyDown()
{

    if (KeyEsc == g.event.keyCode)
    {
        g.event.returnValue = false;
        g.event.keyCode = 0;
    }

    OnKeyDown();
}

var g_AcceptMS_EULA = false;
var g_AcceptOEM_EULA = false;
function EulaRadioClicked()
{
    
    if(g.btnNext.disabled && (g.radioAgree.checked || g.radioDisAgree.checked))
    {
        g.btnNext.onmouseover = HandleNextButtonMouseOver;
        g.btnNext.onmouseout  = HandleNextButtonMouseOut;
        g.btnNext.onmousedown = HandleNextButtonMouseDown;
        g.btnNext.className="newbuttonsNext";
        g.btnNext.disabled = false;
        g.btnNext.onclick = EulaNextBtnHandler;
        g.btnNext.focus();

    }

    if (g.radioAgree.checked)
        g_EULA_radiosticky=1;
    else
        g_EULA_radiosticky=2;

    g_AcceptMS_EULA  = g.radioAgree.checked;
    g_AcceptOEM_EULA = g.radioAgree.checked;
}

function StoreEula()
{
    EulaObj.set_EULAAcceptance = g.radioAgree.checked;
}


var g_daylight=SysClockObj.get_AutoDaylight();
var g_CurTimeZoneIdx = SysClockObj.get_TimeZoneIdx();

function HandleTZChkBox()
{
    g_daylight = g.daylight.checked;  

    OnClick();
}

function HandleSelTZChange()
{
    g_CurTimeZoneIdx = g.selTimeZone.selectedIndex;
    g.daylight.disabled = !SysClockObj.get_DaylightEnabled(g_CurTimeZoneIdx);
}


function TimeZone_LoadMe()
{
    InitFrameRef();
    g_FirstFocusElement = g.selTimeZone;
    InitNewButtons();

    g.daylight.checked = g_daylight;
    g.daylight.onclick = HandleTZChkBox;
    g.selTimeZone.onchange=HandleSelTZChange;
    g.selTimeZone.selectedIndex = 0;  
    g.selTimeZone.selectedIndex = g_CurTimeZoneIdx;
    g.daylight.disabled = !SysClockObj.get_DaylightEnabled(g_CurTimeZoneIdx);

    g_FirstFocusElement.focus();
}





var g_RegionSelIdx=LangObj.get_RegionIndex();
var g_LangSelIdx=LangObj.get_LangIndex();
var g_KeyboardSelIdx=LangObj.get_KeyboardLayoutIndex();

function RegKBCmt_LoadMe()
{
    InitFrameRef();
    g_FirstFocusElement = g.btnNext;
    InitNewButtons();

    g.newkeybdname.innerText=LangObj.get_KeyboardLayoutName(g_KeyboardSelIdx);
    g.newregionname.innerText=LangObj.get_RegionName(g_RegionSelIdx);
    g.newlangname.innerText=LangObj.get_LangName(g_LangSelIdx);

    g_FirstFocusElement.focus();
}







var iMaxKeybdNameLen=1;
var iMaxRegionNameLen=1;
var iMaxLangNameLen=1;

function HandleKeybdPageSelMenuChange() {
    var namestr=g.event.srcElement.id.slice(3);
    eval('g.'+namestr+'Name.value=g.event.srcElement.options(g.event.srcElement.selectedIndex).text;');
    eval('g_'+namestr+'SelIdx='+'g.event.srcElement.selectedIndex;');
}

function SetKeybdFocus() {
    g.selKeyboard.focus();
}

function SetRegionFocus() {
    g.selRegion.focus();
}

function SetLangFocus() {
    g.selLang.focus();
}


var L_LangStr_Text="I <u>t</u>ype mostly in this language:";
var LangStrSmall=L_LangStr_Text;
var L_RegionStr_Text="I li<u>v</u>e closest to this region:";
var RegionStrSmall=L_RegionStr_Text;
var L_KeybdStr_Text="I <u>u</u>se this type of keyboard:";
var KeybdStrSmall=L_KeybdStr_Text;
var L_KeybdTitleSmall_Text="Select Your System Settings";
var L_KeybdStrHint_Text="Hint: For a standard English-language keyboard, select US.";
var KeybdStrHintSmall=L_KeybdStrHint_Text;



function RegKBLoadMe()
{
    InitFrameRef();

    g_FirstFocusElement = g.selRegion;

    InitNewButtons();
    RetrieveRegKB();

    g.selKeyboard.onchange = HandleKeybdPageSelMenuChange;
    g.selRegion.onchange   = HandleKeybdPageSelMenuChange;
    g.selLang.onchange     = HandleKeybdPageSelMenuChange;

    

    g.KeyboardName.onfocus  = SetKeybdFocus;
    g.RegionName.onfocus    = SetRegionFocus;
    g.LangName.onfocus      = SetLangFocus;

    
    g.RegionName.value=g.selRegion.options(g.selRegion.selectedIndex).text;
    g_RegionSelIdx=g.selRegion.selectedIndex;
    g.LangName.value=g.selLang.options(g.selLang.selectedIndex).text;
    g_LangSelIdx=g.selLang.selectedIndex;
    g.KeyboardName.value=g.selKeyboard.options(g.selKeyboard.selectedIndex).text;
    g_KeyboardSelIdx=g.selKeyboard.selectedIndex;

    
    if(!g_bInHighScreenRes) {
        g.KeybdStr.innerHTML=KeybdStrSmall;
        g.RegionStr.innerHTML=RegionStrSmall;
        g.LangStr.innerHTML=LangStrSmall;
        g.KeybdStrHint.innerHTML=KeybdStrHintSmall;

        for(i=3;i<=5;i++) {
            eval("g.LargeResSpc"+i.toString()+".style.display='none';");
        }
        g.KeyBdTitle.innerText=L_KeybdTitleSmall_Text;
    } else {
        g.KeybdStr.innerHTML=L_KeybdStr_Text;
        g.RegionStr.innerHTML=L_RegionStr_Text;
        g.LangStr.innerHTML=L_LangStr_Text;
        g.KeybdStrHint.innerHTML=L_KeybdStrHint_Text;
    }

    g.LangStr.style.visibility="visible";
    g.KeybdStr.style.visibility="visible";
    g.RegionStr.style.visibility="visible";
    g.KeybdStrHint.style.visibility="visible";

    g.selRegion.style.visibility="visible";
    g.selKeyboard.style.visibility="visible";
    g.selLang.style.visibility="visible";

    g.KeyboardName.style.visibility="visible";
    g.RegionName.style.visibility="visible";
    g.LangName.style.visibility="visible";

    g.KeyboardName.style.cursor="default";
    g.RegionName.style.cursor="default";
    g.LangName.style.cursor="default";

    g_FirstFocusElement.focus();
}





function RegKB_KeyPress()
{
    try
    {
        if (g.event == null)
            return;
    }
    catch(e)
    {
        return;
    }

    if (g.event.keyCode == KeyEnter)
        GoNext();

}

function RetrieveRegKB()
{
    if(LangObj.get_RegionIndex() > 20000) {
        alert("error loading default region index: possible problem in locale.inf");
    }

    if(LangObj.get_KeyboardLayoutIndex() > 20000) {
        alert("error loading default keybd index: possible problem in locale.inf");
    }

    if(LangObj.get_LangIndex() > 20000 ) {
        alert("error loading default lang index: possible problem in locale.inf/content.inf");
    }

    var ilen = LangObj.get_NumOfRegions();
    for (var i = 0; i < ilen; i++)
    {
        var oOption  = g.document.createElement("OPTION");
        oOption.text = LangObj.get_RegionName(i);
        g.selRegion.add(oOption);

        if(oOption.text.length > iMaxRegionNameLen) {
            iMaxRegionNameLen=oOption.text.length;
        }
    }

    ilen = LangObj.get_NumOfLangs();
    for (var i = 0; i < ilen; i++)
    {
        var oOption  = g.document.createElement("OPTION");
        oOption.text = LangObj.get_LangName(i);
        g.selLang.add(oOption);

        if(oOption.text.length > iMaxLangNameLen) {
            iMaxLangNameLen=oOption.text.length;
        }
    }

    ilen = LangObj.get_NumOfKeyboardLayouts();
    for (i = 0; i < ilen; i++)
    {
        var oOption  = g.document.createElement("OPTION");
        oOption.text = LangObj.get_KeyboardLayoutName(i);
        g.selKeyboard.add(oOption);

        if(oOption.text.length > iMaxKeybdNameLen)
            iMaxKeybdNameLen=oOption.text.length;
    }

    
    g.selRegion.selectedIndex = 0;  
    g.selRegion.selectedIndex= g_RegionSelIdx;  

    g.selKeyboard.selectedIndex = 0;  
    g.selKeyboard.selectedIndex= g_KeyboardSelIdx;

    g.selLang.selectedIndex = 0;  
    g.selLang.selectedIndex= g_LangSelIdx;
}





var g_IsActivationSuccessful      = false;
var g_IsMSRegistrationSuccessful  = false;
var g_IsOEMRegistrationSuccessful = false;

var g_ShowParagraph = false;
function ShowFinish_Paragraph_Header()
{
    if (g_ShowParagraph)
    {
        g.FiniSummaryIntro2.style.display = "inline";
    }
}

function FinishPage_LoadMe()
{
    InitFrameRef();

        if (g_IsActivationSuccessful)
        {
            var L_ActivateWindows_Text = "You activated your copy of Windows.<BR>";

            g_ShowParagraph = true;
            g.FiniSummary0.innerHTML = L_ActivateWindows_Text;
            g.FiniSummary0.style.display = "inline";
        }

        
        if (1 != window.external.get_RegStatus())
        {
            if (1 == RegisterObj.get_PostToOEM && g_IsOEMRegistrationSuccessful)
            {
                var strOEMName = g_OEMNameStr;

                if (strOEMName == null || (strOEMName != null && strOEMName.length == 0))
                {
                    var L_RegisterdWith_Text = "You registered your computer with the OEM.<BR>";

                    g.FiniSummary1.innerHTML = L_RegisterdWith_Text;
                }
                else
                {
                    var L_RegisterdWith_Text = "You registered your computer with %1.<BR>";

                    g.FiniSummary1.innerHTML = ApiObj.FormatMessage(L_RegisterdWith_Text, strOEMName);
                }

                g_ShowParagraph = true;
                g.FiniSummary1.style.display = "inline";
            }

            if (g_IsMSRegistrationSuccessful)
            {
                var L_RegisterdWithMS_Text = "You registered your copy of Windows with Microsoft.<BR>";

                g_ShowParagraph = true;
                g.FiniSummary2.innerHTML = L_RegisterdWithMS_Text;
                g.FiniSummary2.style.display = "inline";
            }
        }

        var bHasSignup = 0;
        try
        {
            bHasSignup = ApiObj.get_RegValue(HKEY_LOCAL_MACHINE, OOBE_MAIN_REG_KEY + "\\TEMP", "ISPSignup");
        }
        catch (e) { bHasSignup = 0;}

        if (bHasSignup || ConnectedToInternetEx(false))
        {
            var L_SignupWith_Text = "Your computer is configured for Internet access.<BR>";

            g_ShowParagraph = true;
            g.FiniSummary3.innerHTML = L_SignupWith_Text;
            g.FiniSummary3.style.display = "inline";
        }

        if (bHasSignup || window.external.ConnectedToInternet())
        {
            window.external.SetICWCompleted();
        }

    ShowFinish_Paragraph_Header();

    if (LANGUAGE_REBOOT_END == LangObj.get_RebootState())
    {
        g.finishmsg.style.display="none";
        g.rebootfinishmsg.style.display="inline";
    }

    g.msgspan.style.display="inline";

    if (g.btnNext != null)
        g_FirstFocusElement = g.btnNext;
    else if (g.btnBack != null)
        g_FirstFocusElement = g.btnBack;

    InitNewButtons();
    g_FirstFocusElement.focus();
}




function badpid_LoadMe()
{
    InitFrameRef();
    g_FirstFocusElement=g.btnBack;

    if (null == PidObj)
    {
        PidObj = new Object;
        PidObj = window.external.ProductID;
    }
    var strPid = PidObj.get_PID();
    for (var i = 0; i < 5; i++)
    {
        g.lblPID[i].innerText = strPid.substr(i * 6, 5);
    }
    if (strPid.length == 0)
        g.PidEntered.style.visibility = "hidden";
    else
        g.PidEntered.style.visibility = "visible";

    InitNewButtons();

    g_FirstFocusElement.focus();

    g_CameFromBadPkeyPage=true;
}










var g_RegisteredOwnerDone = false;
var g_UsernameFirstname_Valid = true;
var g_UsernameLastname_Valid  = true;
function UserName_LoadMe()
{
    InitFrameRef();
    g_FirstFocusElement = g.txtUserFirstName;

    
    if (IsFarEastLocale())
    {
        g.MainPageCell.style.display="none"; 

        if (IsKoreanLocale())
        {
            g.spnUserName_Primary3.style.display="inline";
            g.LastNameRow.style.display="none";
            g.EnterUserFirstName_1.innerHTML=L_FullName_Text;
            if (IspAccountObj.HasSignUp())
            {
                g.UserName_IspAccountNameF.innerText = IspAccountObj.UserName;
                g.UserName_IspAccountNameF.style.display = "inline";
            }
        }
        else
        {
            g.spnUserName_Primary2.style.display="inline";
            if (g.LastNameRow == g.FieldTable.rows[1])
            {
                
                var i = g.txtUserLastName.tabIndex;
                g.txtUserLastName.tabIndex = g.txtUserFirstName.tabIndex;
                g.txtUserFirstName.tabIndex = i;
                
                g.FieldTable.moveRow(1,0); 

            }
            if ((!g_UsernameFirstname_Valid) && (g_UsernameLastname_Valid))
                g_FirstFocusElement = g.txtUserFirstName;
            else
                g_FirstFocusElement = g.txtUserLastName;

            if (IspAccountObj.HasSignUp())
            {
                g.UserName_IspAccountNameL.innerText = IspAccountObj.UserName;
                g.UserName_IspAccountNameL.style.display = "inline";
            }
        }

        g.MainPageCell.style.display="inline";
    }
    else
    {
        if ((!g_UsernameLastname_Valid) && (g_UsernameFirstname_Valid))
            g_FirstFocusElement = g.txtUserLastName;

        g.spnUserName_Primary1.style.display="inline";
        if (IspAccountObj.HasSignUp())
        {
            g.UserName_IspAccountNameF.innerText = IspAccountObj.UserName;
            g.UserName_IspAccountNameF.style.display = "inline";
        }
    }

    g_FirstFocusElement.focus();
    InitNewButtons();
}







var g_CameFromBadPkeyPage=false;

var g_LastFocusedPidBox;
var g_SelectionExistsBeforeKeyPress=null;

function PIDBox_HandleBlur() {
    g_LastFocusedPidBox=g.event.srcElement;
}

function PIDBox_HandleFocus() {
    g_LastFocusedPidBox=g.event.srcElement;
    OnFocus();
}

function PID_LoadMe()
{
    InitFrameRef();

    
    if (window.external.get_RetailOOBE())
    {
        
        g.PID_Retail_span.style.display="inline";
    }
    else
    {
        
        g.PID_OEM_span.style.display="inline";
    }

    g_FirstFocusElement = g.edtProductKey[0];
    RetrievePid();

    g_FirstFocusElement.focus();
    var rangefocus = g_FirstFocusElement.createTextRange();
    rangefocus.collapse();
    rangefocus.moveStart("word", 0);
    rangefocus.select();

    g_TabForward = false;
    g_TabBackward = false;

    PID_CheckLength(false);

    if(DebugObj.get_MsDebugMode) {
    
    
    }

    for (i = 0; i <= 4; i++)
    {
        g.edtProductKey[i].onblur=PIDBox_HandleBlur;
        g.edtProductKey[i].onfocus=PIDBox_HandleFocus;
    }

    g_LastFocusedPidBox=g.edtProductKey[0];

    InitNewButtons();

    if(g_CameFromBadPkeyPage) {
        g.edtProductKey[0].select();
        g_CameFromBadPkeyPage=false;
    }
}

var g_CharCode0_plus1=("0".charCodeAt(0))+1;

function KeyboardHelperClick()
{
    try
    {
        if (g.event == null)
            return;
    }
    catch(e)
    {
        return;
    }

    g.event.returnValue = false;  
    g.event.cancelBubble = true;

    if (g.event.srcElement.tagName == "BUTTON") {

        g_LastFocusedPidBox.focus();

        if(g.document.selection.type=="Text") {
            g.document.execCommand("Delete");

            if(g.event.srcElement.name=="{BACKSPACE}")
                return;
        }

        if(g.event.srcElement.name=="{BACKSPACE}") {
            var tr=g_LastFocusedPidBox.createTextRange();
            tr.collapse(false);
            tr.moveStart("character",-1);
            tr.execCommand("Delete");
            return;
        }

        var i=g_LastFocusedPidBox.id.charCodeAt(3)-g_CharCode0_plus1;

        if((i<4) && (g_LastFocusedPidBox.value.length == 5) && CursorAtEndOfField(i) && (!g_SelectionExistsBeforeKeyPress)) {
            TabForward(i,false);
            
        }

        if (g_LastFocusedPidBox.value.length != 5) {

            g_LastFocusedPidBox.value+=g.event.srcElement.name;

            

            Agent_OnProductKeyKeyboardHelper(g_LastFocusedPidBox, g.event.srcElement.name);

            if (g_TabBackward) {
                TabBackward(i,false);
            } else if(g_TabForward) {
                TabForward(i,false);
            }

            g_TabForward = false;
            g_TabBackward = false;
        }
    }

}

function PID_CheckLength(KnownIncomplete)
{
    

    if(KnownIncomplete) {
        g.btnNext.onclick = null;
        g.btnNext.disabled = true;
        g.btnNext.className="newbuttonsNext-disabled";
        return;
    }

    var TotLength=g.edtProductKey[0].value.length+g.edtProductKey[1].value.length+
        g.edtProductKey[2].value.length+g.edtProductKey[3].value.length+
        g.edtProductKey[4].value.length;

    if (TotLength == 25)
    {
        g.btnNext.disabled = false;
        g.btnNext.className="newbuttonsNext";
        g.btnNext.onclick = GoNext;
    }
    else
    {
        g.btnNext.onclick = null;
        g.btnNext.disabled = true;
        g.btnNext.className="newbuttonsNext-disabled";
    }
}

function RetrievePid()
{
    
    var strPid = PidObj.get_PID();

    
    
    if (strPid.length == 0)
    {
        g.edtProductKey[0].focus();
    }
    
    
    else
    {
        var re = new RegExp("(.*)-(.*)-(.*)-(.*)-(.*)","");
        if(re.exec(strPid) == null) {
            throw "Internal error:  RegExp pattmatch failed!";
        }

        g.edtProductKey[0].value = RegExp.$1;
        g.edtProductKey[1].value = RegExp.$2;
        g.edtProductKey[2].value = RegExp.$3;
        g.edtProductKey[3].value = RegExp.$4;
        g.edtProductKey[4].value = RegExp.$5;
    }
}

    var g_TabForward = false;
function TabForward(currentEdit,DoSelectAll)
{
    g_TabForward = false;

    if(currentEdit==4) {
        
        if(g.document.selection.type!="None") {
            g.document.selection.empty();
        }
        g.btnBack.focus();
        return;
    }

    currentEdit++;

    g.edtProductKey[currentEdit].focus();

    if(DoSelectAll) {
        g.edtProductKey[currentEdit].select();
        return;
    }

    var tr = g.edtProductKey[currentEdit].createTextRange();
    tr.collapse(true);
    tr.moveStart("word", 0);
    tr.select();

}

    var g_TabBackward = false;
function TabBackward(currentEdit,DoSelectAll)
{
    g_TabBackward = false;

    if (currentEdit == 0) {
        
        if(g.document.selection.type!="None") {
            g.document.selection.empty();
        }
        if(g.btnNext.disabled) {
            g.btnBack.focus();
        } else {
            g.btnNext.focus();
        }

        return;
    }

    currentEdit--;

    g.edtProductKey[currentEdit].focus();

    if(DoSelectAll) {
        g.edtProductKey[currentEdit].select();
        return;
    }

    var tr = g.edtProductKey[currentEdit].createTextRange();
    tr.collapse(false);
    tr.moveStart("word", 1);
    tr.select();
}

function CursorAtStartOfField(currentEdit) {
    var tr = g.edtProductKey[currentEdit].createTextRange();
    var tr2 = g.document.selection.createRange();

    tr2.moveEnd("textedit",1);

    if(tr.isEqual(tr2)){
        return true;
    } else {
        return false;
    }
}

function CursorAtEndOfField(currentEdit) {
    

    var tr = g.edtProductKey[currentEdit].createTextRange();
    var tr2 = g.document.selection.createRange();

    tr2.moveStart("textedit",-1);

    if(tr.isEqual(tr2)){
        return true;
    } else {
        return false;
    }
}

function IsProductIDKey(keyCode)
{
    var str = String.fromCharCode(keyCode);

    var result = str.match(/B|C|D|F|G|H|J|K|M|P|Q|R|T|V|W|X|Y|2|3|4|6|7|8|9/);

    return (null != result);
}

var g_keyPressKeyCode = 0;

function ProductIDPropertyChange()
{
    try
    {
        if (g.event == null)
            return;
    }
    catch(e)
    {
        return;
    }

    
    

    if ("value" == g.event.propertyName) {

        
        var i=g.event.srcElement.id.charCodeAt(3)-g_CharCode0_plus1;

        
        
        
        switch(g.edtProductKey[i].value.length) {
            case 5:
                g_TabForward = (i<4);  
                PID_CheckLength(false);
                break;

            case 4:
            case 0:
            case 1:
                PID_CheckLength(true);  
        }

        
        
        

        
        
        if ((g.edtProductKey[i].value.length == 0) && (i > 0) &&
                (g_keyPressKeyCode==KeyBackSpc)&&(g_keyPressKeyCode==KeyDelete)&&
                (g.document.selection.type=="None")) {

            g_TabBackward = true; 
        }
    }

    g_keyPressKeyCode = 0;
}








function ProductIDKeyPress()
{
    try
    {
        if (g.event == null)
            return;
    }
    catch(e)
    {
        return;
    }

    
    


    if (g.event.keyCode == KeyBackSpc) {
        ProductIDKeyDown();
        return;
    }

    KeyCodeToUpper();

    g_keyPressKeyCode = g.event.keyCode;

    if (!IsProductIDKey(g_keyPressKeyCode)) {
        g.event.keyCode = 0;
        return;
    } else {

        var i=g.event.srcElement.id.charCodeAt(3)-g_CharCode0_plus1;

        if((i<4) && (g.edtProductKey[i].value.length == 5) && CursorAtEndOfField(i) && (!g_SelectionExistsBeforeKeyPress)) {
            TabForward(i,false);
        }
    }
}




















function ProductIDKeyDown()
{

    try
    {
        if (g.event == null)
            return;
    }
    catch(e)
    {
        return;
    }

    var keyCode = g.event.keyCode;

    g_SelectionExistsBeforeKeyPress=(g.document.selection.type!="None");

    if(g.event.srcElement.tagName=="INPUT") {
        var i=g.event.srcElement.id.charCodeAt(3)-g_CharCode0_plus1;
    } else {
        var i=-1;
    }

    switch(keyCode) {

        case KeyTab:
            if(g.event.srcElement == g.edtProductKey[i]) {
                if(g.event.shiftKey)
                    TabBackward(i,true);
                else TabForward(i,true);

                g.event.returnValue = false;
                g.event.keyCode = 0;
                g.event.cancelBubble = true;
                break;
            }
            break;

        case KeyLeftArrow:
            if((i>0) && CursorAtStartOfField(i)) {
                TabBackward(i,false);
                g.event.returnValue = false;
            }
            break;

        case KeyRightArrow:
            if((i<4) && CursorAtEndOfField(i)) {
                TabForward(i,false);
                g.event.returnValue = false;
            }
            break;

        case KeyBackSpc:
        case KeyDelete:

            
            
            
            
            
            

            
            

            
            

            if ((i > 0) &&
                    (   ((g.document.selection.type=="None") && (g.edtProductKey[i].value.length == 0))
                        ||((keyCode==KeyBackSpc)&& CursorAtStartOfField(i)))) {

                TabBackward(i,false);
                g.event.returnValue = false; 
                g.event.keyCode = 0;
            }

            break;

        case KeyEnter:
            if((g.btnNext.disabled == false)&&(g.event.srcElement!=g.btnBack)) {
                g.btnNext.click();
                g.event.returnValue = false;
                g.event.keyCode = 0;
                g.event.cancelBubble = true;
            }
            break;
    }
}

function ProductIDKeyUp()
{
    try
    {
        if (g.event == null)
            return;
    }
    catch(e)
    {
        return;
    }

    if((!g_TabForward) && (!g_TabBackward)) {
        return;
    }

    var i=g.event.srcElement.id.charCodeAt(3)-g_CharCode0_plus1;

    if (g_TabBackward) {
        TabBackward(i,false);
        return;
    } else
        if(g_TabForward) {
            TabForward(i,false);
        }
}


function PID_SetCorrectFocus()
{
    try
    {
        if (g.event == null)
            return;
    }
    catch(e)
    {
        return;
    }

    if((g.event.srcElement.tagName == "INPUT")||(g.event.srcElement.tagName == "BUTTON")) {
        return;
    }

    

    for (var i = 0; i < 5; i++)
    {
        if (g.event.srcElement == g.edtProductKey[i])
        {
            return;
        }
    }

    
    if((g.btnNext.disabled == false) && (g.btnNext.contains(g.event.srcElement) || g.btnBack.contains(g.event.srcElement)))
        return;

    for (var i = 4; i >= 0; i--)
    {
        if (g.edtProductKey[i].value.length < 5 && g.edtProductKey[i].value.length > 0)
        {
            g.edtProductKey[i].focus();
            var range = g.edtProductKey[i].createTextRange();
            range.collapse();
            range.moveStart("word", 1);
            range.select();
            return;
        }
    }

    if (i < 0)
    {
        g.edtProductKey[0].focus();
        var range = g.edtProductKey[0].createTextRange();
        range.collapse();
        range.moveStart("word", 0);
        range.select();
        return;
    }
}






function hndshake_OnKeyPress()
{
    try
    {
        if (g.event == null)
            return;
    }
    catch(e)
    {
        return;
    }

    
    if ((g.event.keyCode == KeyEnter) &&
            (g.btnNext.disabled == false))
    {
        GoNext();
    }
    else
    {
        KeyPressIsValid();
    }
}


function hndshake_CheckEdits()
{
    try
    {
        if (g.event == null)
            return;
    }
    catch(e)
    {
        return;
    }

    if (g.event.srcElement != g.edtMSNPhoneNumber)
    {
        hndshake_CheckEnableNextButton();
    }
}


function hndshake_CheckEnableNextButton()
{
    try
    {
        if (g.event == null)
            return;
    }
    catch(e)
    {
        return;
    }

    if (g.edtMSNPhoneNumber.value.length)
    {
        g.btnNext.disabled = false;
    }
    else
    {
        g.btnNext.disabled = true;
    }

    InitNewButtons();
}


function hndshake_LoadMe()
{
    InitFrameRef();

    g_FirstFocusElement = g.edtMSNPhoneNumber;

    hndshake_CheckEnableNextButton();

    g_FirstFocusElement.focus();
}




function Newpberr_LoadMe()
{
    New_Default_LoadMe('SimpleBack');

    var L_pbErrOEMName_Text = g_OEMNameStr;
    if (L_pbErrOEMName_Text == "")
    {
        L_pbErrOEMName_Text = L_MissingOEMName_Text;
    }

    var L_MainPBerrMsg_Text = "";

    if (g_DoActivation)
    {
        if  ((g_PostToMS) && (g_PostToOEM))
        {
            L_MainPBerrMsg_Text    = "Online registration and activation are currently unavailable in your country or region. To register your computer later without an Internet connection, please contact %1. You can activate your copy of Windows later using an Internet connection or by contacting Microsoft over the telephone.";
            g.pberr_par1.innerText = ApiObj.FormatMessage(L_MainPBerrMsg_Text, L_pbErrOEMName_Text);
        }
        else if ((g_PostToMS) && (!g_PostToOEM))
        {
            L_MainPBerrMsg_Text    = "Online registration and activation are currently unavailable in your country or region. You can activate your copy of Windows later using an Internet connection or by contacting Microsoft by telephone. An Internet connection is needed to register your copy of Windows with Microsoft.";
            g.pberr_par1.innerText = L_MainPBerrMsg_Text;
        }
        else if ((!g_PostToMS) && (g_PostToOEM))
        {
            L_MainPBerrMsg_Text    = "Online activation is currently unavailable in your country or region. You can activate your copy of Windows later using an Internet connection or by contacting Microsoft by telephone. To register your computer later without an Internet connection, please contact %1.";
            g.pberr_par1.innerText = ApiObj.FormatMessage(L_MainPBerrMsg_Text, L_pbErrOEMName_Text);
        }
        else
        {
            
            L_MainPBerrMsg_Text    = "Online activation is currently unavailable in your country or region. You can activate your copy of Windows later using an Internet connection or by contacting Microsoft over the telephone.";
            g.pberr_par1.innerText = L_MainPBerrMsg_Text;
        }
    }
    else
    {
        if ((!g_PostToMS) && (g_PostToOEM))
        {
            L_MainPBerrMsg_Text    = "Online registration is currently unavailable in your country or region. To register your computer later without an Internet connection, please contact %1.";
            g.pberr_par1.innerText = ApiObj.FormatMessage(L_MainPBerrMsg_Text, L_pbErrOEMName_Text);
        }
    }
}





var g_Domain = ( window.external.GetNetJoinStatus() == JOIN_STATUS_DOMAIN );
var g_DomainName = null;
var g_DomainUser = null;
var g_DomainPass = null;
var g_DomainDone = false;

function jndomain_OnKeyPress()
{
    try
    {
        if (g.event == null)
            return;
    }
    catch(e)
    {
        return;
    }

    if (g.event.keyCode == KeyEnter)
    {
        jndomainNextBtnHandler();
    }
}

function jndomainNextBtnHandler()
{
    if (g.radioYesDomain.checked)
    {
        g_Domain = g.radioYesDomain.checked;
        g_DomainName = g.textboxDomain.value;
        Navigate("setup\\jndom_a.htm");  
    }
    else
    {
        g_Domain = !g.radioNoDomain.checked;
        g_DomainName = "";
        GoNext();
    }
}

var jndom_rb_stat = 0;
function jndomainLoadMe()
{
    InitFrameRef();

    g_FirstFocusElement = g.btnNext;
    g_FirstFocusElement.focus();

    InitNewButtons();
    g.radioYesDomain.checked = false;
    g.radioNoDomain.checked = false;

    if (jndom_rb_stat==0)
        g.radioNoDomain.checked=true;
    else
        g.radioYesDomain.checked=true;

    checkJoinDomain();
    g.btnNext.onclick = jndomainNextBtnHandler;
}

function jndom_a_OnKeyPress()
{
    try
    {
        if (g.event == null)
            return;
    }
    catch(e)
    {
        return;
    }

    if (g.event.keyCode == KeyEnter)
    {
        jndomain2NextBtnHandler();
    }
}

function jndomain2NextBtnHandler()
{
    g_DomainUser = g.textboxDomUser.value;
    g_DomainPass = g.textboxDomPass.value;

    GoNext();
}

function jndomainLoadMe2()
{
    InitFrameRef();

    if (g.btnNext != null)
     g_FirstFocusElement = g.btnNext;
    else
    if (g.btnSkip != null)
     g_FirstFocusElement = g.btnSkip;
    else
    if (g.btnBack != null)
     g_FirstFocusElement = g.btnBack;

    InitNewButtons("SimpleBack", null);

    if (g_FirstFocusElement != null)
     g_FirstFocusElement.focus();
    else
     g.document.body.focus();

    g.btnNext.onclick = jndomain2NextBtnHandler;
}

function checkJoinDomain()
{
    if (g.radioNoDomain.checked)
    {
        g.textboxDomain.disabled = true;
        g.textboxDomain.style.backgroundColor='#dddddd';
        jndom_rb_stat = 0;
    }
    else
    {
        g.textboxDomain.disabled = false;
        g.textboxDomain.style.backgroundColor='#ffffff';
        jndom_rb_stat = 1;
    }
}




var g_AdminPassword = null;

function validatePassword()
{
    if (g.ConfirmPass.value != g.SecurityPass.value)
    {
        g.SecurityPass.value = "";
        g.ConfirmPass.value = "";
        g.SecurityExplHidden.style.display = "";
        }
     else
        GoNext();
}

function SecurityPasswordLoadMe()
{
    InitFrameRef();
    InitNewButtons();
    g_FirstFocusElement = g.SecurityPass;
    g_FirstFocusElement.focus();
    g_FirstFocusElement.select();
    g.btnNext.onclick = validatePassword;
}


















function InitCKPT()
{

    
    
    dnCKPT[CKPT_ANIMATION] = new CheckPoint("",                           SNDX_WELCOME,     SNDX_WELCOME,       SNDX_WELCOME,       SNDX_WELCOME);
    dnCKPT[CKPT_HWCHK] = new CheckPoint("",                               SNDX_WELCOME,     SNDX_WELCOME,       SNDX_WELCOME,       SNDX_WELCOME);
    dnCKPT[CKPT_WELCOME] = new CheckPoint("setup\\welcome.htm",           SNDX_WELCOME,     SNDX_WELCOME,       SNDX_WELCOME,       SNDX_WELCOME);
    dnCKPT[CKPT_OOBEDISC] = new CheckPoint("setup\\oobedisc.htm",         SNDX_LEGAL,       SNDX_LEGAL,         SNDX_LEGAL,         SNDX_LEGAL);
    dnCKPT[CKPT_MOUSETUT1] = new CheckPoint("html\\mouse\\mouse.htm",     SNDX_HW,          SNDX_HW,            SNDX_HW,            SNDX_HW);
    dnCKPT[CKPT_IMETUTORIAL] = new CheckPoint("html\\IME\\IMETut1.htm",   SNDX_HW,          SNDX_HW,            SNDX_HW,            SNDX_HW);
    dnCKPT[CKPT_OEMHW] = new CheckPoint("html\\oemhw\\oemhw.htm",         SNDX_HW,          SNDX_HW,            SNDX_HW,            SNDX_HW);
    dnCKPT[CKPT_REGION_KEYBD] = new CheckPoint("setup\\keybd.htm",        SNDX_HW,          SNDX_HW,            SNDX_HW,            SNDX_HW);
    dnCKPT[CKPT_REGKB_COMMIT] = new CheckPoint("setup\\keybdcmt.htm",     SNDX_HW,          SNDX_HW,            SNDX_HW,            SNDX_HW);
    dnCKPT[CKPT_TIMEZONE] = new CheckPoint("setup\\timezone.htm",         SNDX_HW,          SNDX_HW,            SNDX_HW,            SNDX_HW);
    dnCKPT[CKPT_EULA] = new CheckPoint("setup\\neweula.htm",              SNDX_LEGAL,       SNDX_LEGAL,         SNDX_LEGAL,         SNDX_LEGAL);
    dnCKPT[CKPT_EULA_DECLINE] = new CheckPoint("setup\\badeula.htm",      SNDX_LEGAL,       SNDX_LEGAL,         SNDX_LEGAL,         SNDX_LEGAL);
    dnCKPT[CKPT_PRODUCTKEY] = new CheckPoint("setup\\prodkey.htm",        SNDX_LEGAL,       SNDX_LEGAL,         SNDX_LEGAL,         SNDX_LEGAL);
    dnCKPT[CKPT_BADPRODUCTKEY] = new CheckPoint("setup\\badpkey.htm",     SNDX_LEGAL,       SNDX_LEGAL,         SNDX_LEGAL,         SNDX_LEGAL);
//    dnCKPT[CKPT_AUTO_UPDATE] = new CheckPoint("setup\\autoupdt.htm",      SNDX_LEGAL,       SNDX_LEGAL,         SNDX_LEGAL,         SNDX_LEGAL);
    dnCKPT[CKPT_COMPNAME] = new CheckPoint("setup\\compname.htm",         SNDX_LEGAL,       SNDX_LEGAL,         SNDX_LEGAL,         SNDX_LEGAL);
    dnCKPT[CKPT_SECPASS]  = new CheckPoint("setup\\security.htm",         SNDX_LEGAL,       SNDX_LEGAL,         SNDX_LEGAL,         SNDX_LEGAL);
    dnCKPT[CKPT_JNDOMAIN] = new CheckPoint("setup\\jndomain.htm",         SNDX_REG,         SNDX_REG,           SNDX_REG,           SNDX_REG);
    dnCKPT[CKPT_ICSCHOICE] = new CheckPoint("setup\\ics.htm",             SNDX_REG,         SNDX_REG,           SNDX_REG,           SNDX_REG);
    dnCKPT[CKPT_SCONNECT] = new CheckPoint("html\\sconnect\\sconnect.htm",SNDX_REG,         SNDX_REG,           SNDX_REG,           SNDX_REG);
    dnCKPT[CKPT_HOMENETWIZPROMPT] = new CheckPoint("setup\\hnwprmpt.htm", SNDX_REG,         SNDX_REG,           SNDX_REG,           SNDX_REG);
    dnCKPT[CKPT_DSLMAIN]  = new CheckPoint("html\\dslmain\\dslmain.htm",  SNDX_REG,         SNDX_REG,           SNDX_REG,           SNDX_REG);
    dnCKPT[CKPT_DSLPPPOE]=new CheckPoint("html\\dslmain\\dsl_a.htm",      SNDX_REG,         SNDX_REG,           SNDX_REG,           SNDX_REG);
    dnCKPT[CKPT_DSLBROADBAND]=new CheckPoint("html\\dslmain\\dsl_b.htm",  SNDX_REG,         SNDX_REG,           SNDX_REG,           SNDX_REG);
    dnCKPT[CKPT_CONGRATS]=new CheckPoint("html\\dslmain\\dsllast.htm",    SNDX_REG,         SNDX_REG,           SNDX_REG,           SNDX_REG);
    dnCKPT[CKPT_ACTIVATION] = new CheckPoint("setup\\activate.htm",       SNDX_REG,         SNDX_REG,           SNDX_REG,           SNDX_REG);
    dnCKPT[CKPT_REGISTER1] = new CheckPoint("setup\\reg1.htm",            SNDX_REG,         SNDX_REG,           SNDX_REG,           SNDX_REG);
    dnCKPT[CKPT_REGISTER3] = new CheckPoint("setup\\reg3.htm",            SNDX_REG,         SNDX_REG,           SNDX_REG,           SNDX_REG);
    dnCKPT[CKPT_ACT_MSG]  = new CheckPoint("setup\\acterror.htm",         SNDX_REG,         SNDX_REG,           SNDX_REG,           SNDX_REG);
    dnCKPT[CKPT_ICONN] = new CheckPoint("setup\\iconn.htm",               SNDX_REG,         SNDX_REG,           SNDX_REG,           SNDX_REG);
    dnCKPT[CKPT_REGDIAL]   = new CheckPoint("setup\\drdyoem.htm",         SNDX_REG,         SNDX_REG,           SNDX_REG,           SNDX_REG);
    dnCKPT[CKPT_ISPSIGNUP] = new CheckPoint("setup\\isp.htm",             SNDX_ISP,         SNDX_ISP,           SNDX_ISP,           SNDX_ISP);
    dnCKPT[CKPT_MIGLIST] = new CheckPoint("setup\\miglist.htm",           SNDX_ISP,         SNDX_ISP,           SNDX_ISP,           SNDX_ISP);
    dnCKPT[CKPT_ISPDIAL]   = new CheckPoint("setup\\drdyisp.htm",         SNDX_ISP,         SNDX_ISP,           SNDX_ISP,           SNDX_ISP);
    dnCKPT[CKPT_REFDIAL]   = new CheckPoint("setup\\drdyref.htm",         SNDX_ISP,         SNDX_ISP,           SNDX_ISP,           SNDX_ISP);
    dnCKPT[CKPT_MIGDIAL]   = new CheckPoint("setup\\drdymig.htm",         SNDX_ISP,         SNDX_ISP,           SNDX_ISP,           SNDX_ISP);
    dnCKPT[CKPT_ISPTYPE]  = new CheckPoint("html\\isptype\\isptype.htm",  SNDX_ISP,         SNDX_ISP,           SNDX_ISP,           SNDX_ISP);
    dnCKPT[CKPT_ICONNECT] = new CheckPoint("html\\iconnect\\iconnect.htm",SNDX_ISP,         SNDX_ISP,           SNDX_ISP,           SNDX_ISP);
    dnCKPT[CKPT_OEMISP] = new CheckPoint("html\\ispsgnup\\ispsgnup.htm",  SNDX_ISP,         SNDX_ISP,           SNDX_ISP,           SNDX_ISP);
    dnCKPT[CKPT_OEMCUST] = new CheckPoint("html\\oemcust\\oemcust.htm",   SNDX_ISP,         SNDX_ISP,           SNDX_ISP,           SNDX_ISP);
    dnCKPT[CKPT_IDENTITIES2] = new CheckPoint("setup\\ident2.htm",        SNDX_IDENTITIES,  SNDX_IDENTITIES,    SNDX_IDENTITIES,    SNDX_IDENTITIES);
    dnCKPT[CKPT_DONE] = new CheckPoint("setup\\fini.htm",                 SNDX_FINI,        SNDX_FINI,          SNDX_FINI,          SNDX_FINI);

    PopCKPT();

    

    g_SimpleNavMap= new ActiveXObject("Scripting.Dictionary");
    g_SimpleNavMap.CompareMode = COMPAREMODE_TEXT;

    InitSimpleNavMap_MouseTut();
    iconnect_InitSimpleNavMap();
    sconnect_InitSimpleNavMap();

}

function PushCKPT(ckpt)
{
    if (ckpt > 0 && ckpt < CKPT_MAX)
    {
        var tos = 0;
        try
        {
            tos = ApiObj.get_RegValue(HKEY_LOCAL_MACHINE, OOBE_MAIN_REG_KEY + CKPT_REG_KEY, TOS_REG_VALUE);
        }
        catch (e) {}
        ApiObj.set_RegValue(HKEY_LOCAL_MACHINE, OOBE_MAIN_REG_KEY + CKPT_REG_KEY, tos.toString(), ckpt);
        ApiObj.set_RegValue(HKEY_LOCAL_MACHINE, OOBE_MAIN_REG_KEY + CKPT_REG_KEY, TOS_REG_VALUE, ++tos);
        ApiObj.FlushRegKey(HKEY_LOCAL_MACHINE);
        g_CurrentCKPT = ckpt;
    }
}

function ClearStatusBar()
{
    StatusBar1.style.backgroundColor = "#bbbbbb";
    StatusBar2.style.backgroundColor = "#bbbbbb";
    StatusBar3.style.backgroundColor = "#bbbbbb";
    StatusBar4.style.backgroundColor = "#bbbbbb";
    StatusBar5.style.backgroundColor = "#bbbbbb";
}

function PaintStatusBar(WhatBar)
{
    

    var HighlightColor = "#00cc00"; 

    if (WhatBar == "1")
    {
        StatusBar1.style.backgroundColor = HighlightColor;
    }
    if (WhatBar == "2")
    {
        StatusBar1.style.backgroundColor = HighlightColor;
        StatusBar2.style.backgroundColor = HighlightColor;
    }
    if (WhatBar == "3")
    {
        StatusBar1.style.backgroundColor = HighlightColor;
        StatusBar2.style.backgroundColor = HighlightColor;
        StatusBar3.style.backgroundColor = HighlightColor;
    }
    if (WhatBar == "4")
    {
        StatusBar1.style.backgroundColor = HighlightColor;
        StatusBar2.style.backgroundColor = HighlightColor;
        StatusBar3.style.backgroundColor = HighlightColor;
        StatusBar4.style.backgroundColor = HighlightColor;
    }
    if (WhatBar == "5")
    {
        StatusBar1.style.backgroundColor = HighlightColor;
        StatusBar2.style.backgroundColor = HighlightColor;
        StatusBar3.style.backgroundColor = HighlightColor;
        StatusBar4.style.backgroundColor = HighlightColor;
        StatusBar5.style.backgroundColor = HighlightColor;
    }
}

function PopCKPT(ckptCheck)
{
    var ckpt = 0;
    try
    {
        var tos = ApiObj.get_RegValue(HKEY_LOCAL_MACHINE, OOBE_MAIN_REG_KEY + CKPT_REG_KEY, TOS_REG_VALUE);
        if (tos > 0)
        {
            ckpt = ApiObj.get_RegValue(HKEY_LOCAL_MACHINE, OOBE_MAIN_REG_KEY + CKPT_REG_KEY, (tos - 1).toString());

            if (null == ckptCheck || ckpt == ckptCheck)
            {
                ApiObj.set_RegValue(HKEY_LOCAL_MACHINE, OOBE_MAIN_REG_KEY + CKPT_REG_KEY, TOS_REG_VALUE, --tos);
                ApiObj.DeleteRegValue(HKEY_LOCAL_MACHINE, OOBE_MAIN_REG_KEY + CKPT_REG_KEY, tos.toString());
                ApiObj.FlushRegKey(HKEY_LOCAL_MACHINE);
            }
        }
    }
    catch (e) {}

    if (ckpt > 0 && ckpt < CKPT_MAX)
    {
        g_CurrentCKPT = ckpt;
    }
    else
        g_CurrentCKPT = null;
}

function EmptyCKPTStack()
{
    while (null != g_CurrentCKPT)
    {
        PopCKPT();
    }
}

function URLFromCKPT(ckpt)
{
    var str = "";
    if (ckpt > 0 && ckpt < CKPT_MAX)
    {
        str = dnCKPT[ckpt].strURL;
    }
    return str;
}

function IndexFromCKPT(ckpt, status)
{
    var index = 0;
    if (ckpt > 0 && ckpt < CKPT_MAX)
    {
        var checkpoint = dnCKPT[ckpt];
        index = checkpoint.rgindex[status];
    }
    return index;
}

function IsLocalFile()
{
    try
    {
        return (-1 != g.location.protocol.indexOf("file"));
    }
    catch (e)
    {
        return false;
    }
}






var g_fVideoGonextStarted = false;
function VideoGoNext(CalledBy)
{
    OOBEDocBody.style.backgroundColor="#4E6FD6";

    if (!g_fVideoGonextStarted)
    {
        g_fVideoGonextStarted = true;

        if (CalledBy == null)
        {
            CalledBy = "Timer";
        }

        trace("VideoGoNext: Called by " + CalledBy);

        
        try
        {
            window.clearTimeout(g_VideoEvent);
        }
        catch(e){}

        if (CalledBy == "Timer")
        {
            GoNext();
        }
        else
        {
            
            setTimeout("GoNext()", 40);
        }

    }
}


function SetBack(strURL)
{
    g_OEMAddBackURL = strURL;
}















function GoCancel(ckpt)
{
    try
    {
        if (IsLocalFile() && g.event == null && (g_CurrentCKPT != g_DialCKPT))
            return;
    }
    catch(e)
    {
        return;
    }

    DisableAllButtons();

    switch (g_CurrentCKPT)
    {
    case CKPT_HWCHK:
        GoNavigate(CKPT_WELCOME);
        break;

    case CKPT_WELCOME:
       
        PushCKPT(CKPT_DONE);
        GoNext();
        break;

    case CKPT_REGION_KEYBD:
        
        GoNavigate(CKPT_TIMEZONE);
        break;

    case CKPT_PRODUCTKEY:
      
        PopCKPT(CKPT_PRODUCTKEY);  
        GoNavigate(CKPT_COMPNAME);
        break;

    case CKPT_COMPNAME:
        g.document.body.style.cursor = "wait";

        
        g.txtCompName.style.backgroundColor='#dddddd';
        g.txtCompName.disabled=true;

        g.txtCompDesc.style.backgroundColor='#dddddd';
        g.txtCompDesc.disabled=true;
        g_ComputerDescription = null;
        
        
        //window.setTimeout("CompName_ChangeComplete(true);",50);
        window.setTimeout("CompName_ChangeComplete(true);",0);
        break;

    case CKPT_ICSCHOICE:
        GoNavigate(CKPT_ACTIVATION);
        break;

    case CKPT_DSLPPPOE:       
    case CKPT_DSLBROADBAND:
    case CKPT_DSLMAIN:
        PopCKPT();
        GoNavigate(CKPT_ACTIVATION);
        break;

    case CKPT_REGISTER3:
        Reg3SaveSettings();  
        g_PostToMS  = false;
        g_PostToOEM = false;
        if ( !g_DoActivation )
        {
            GoNavigate(CKPT_ICONN);
            break;
        }
        else if (UseNetwork())
        {
            LanActReg();
            break;
        }
        else
        {
            GoNavigate(CKPT_REGDIAL);
            break;
        }
        break;

    case CKPT_ISPSIGNUP:
        GoNavigate(CKPT_OEMCUST);
        break;

    case CKPT_MIGLIST:
        
        GoNavigate(CKPT_OEMCUST);
        break;

    case CKPT_REGDIAL:
        GoNavigate(CKPT_ICONN);
        break;

    case CKPT_REFDIAL:
    case CKPT_MIGDIAL:
    case CKPT_ISPDIAL:
        
        GoNavigate(CKPT_OEMCUST);
        break;

    case CKPT_IDENTITIES2:
        InfoObj.set_UseIdentities(false);
        GoNavigate(CKPT_DONE);
        
        break;

    default:
        GoNext();
        break;
    }


}














function GoBack(ckpt)
{
    try
    {
        if (IsLocalFile() && g.event == null && (g_CurrentCKPT != g_DialCKPT))
            return;
    }
    catch(e)
    {
        return;
    }

    DisableAllButtons();

    if(g_CurrentCKPT == g_DialCKPT)
        ResetDialing();
    else if(g_CurrentCKPT == CKPT_ISPSIGNUP)
        ResetDialing();
    else if(g_CurrentCKPT == CKPT_REGISTER1)
        Reg1SaveRadioState(); 
    else if(g_CurrentCKPT == CKPT_REGISTER3)
        Reg3SaveSettings();  
    else if(g_CurrentCKPT == CKPT_PRODUCTKEY)
        StorePid();
    else if(g_CurrentCKPT == CKPT_IDENTITIES2)
        Identities2_OnLeave();
    

    {
        var ckptPrevious = g_CurrentCKPT;
        PopCKPT();

        if (ckptPrevious == g_CurrentCKPT)
        {
            
            PopCKPT();
        }

        if (g_CurrentCKPT > 0 && g_CurrentCKPT < CKPT_MAX)
        {
            GoNavigate(g_CurrentCKPT);
        }
    }
}

function StatusNavigate()
{
    window.external.set_StatusIndex(IndexFromCKPT(g_CurrentCKPT, g_status));
}




function OnDeviceArrival(nDeviceType)
{
    if (CKPT_HWCHK == g_CurrentCKPT)
    {
        GoNavigate(CKPT_HWCHK);
    }
}





















function GoNavigate(ckptGoHere)
{
    try
    {
        if (g_bStartup == false)
        {
            if (IsLocalFile())
            {
                if (g.event != null)
                {
                    g.event.returnValue = false;
                    g.event.cancelBubble = true;
                }
            }
        }
        else
            g_bStartup = false;

    }
    catch(e)
    {
        return;
    }

    switch (ckptGoHere)
    {
    case CKPT_ANIMATION:
        trace("GoNavigate: CKPT_ANIMATION");
        try
        {

            
            if (!DirObj.get_DoSkipAnimation() && FileSystemObj.FileExists(g_OOBEDirPath+"images\\intro.wmv"))
            {
                PushCKPT(CKPT_ANIMATION);
                IntroAnimation.settings.enableErrorDialogs = false;
                MovieFrame.style.display = "inline";
                IntroAnimation.style.visibility = "visible";

                
                
                
                
                
                
                g_VideoEvent = window.setTimeout(VideoGoNext, 20000);
                IntroAnimation.Controls.Play();    
                break;
            }
        }
        catch(err)
        {
            var temp = "EXCEPTION THROWN: WMP control failed to play or disable dialogs.";
            temp += "\rerror name: " + err.name;
            temp += "\rmessage: " + err.message;
            temp += "\rnumber: " + err.number;
            temp += "\rdescription: " + err.description;
            trace(temp);
        }

        

    case CKPT_HWCHK:
        trace("GoNavigate: CKPT_HWCHK");

        
        if (window.external.get_RetailOOBE() && DirObj.get_IntroOnly())
        {
            trace("Skipping the rest of OOBE because IntroOnly is set");
            PushCKPT(CKPT_DONE);
            GoNext();
            break;
        }

        PushCKPT(CKPT_HWCHK);

        
        OOBEDocBody.style.cursor = "default";
        ScreenFrame.style.display = "inline";

        var bKeyboardPresent = window.external.CheckKeyboard();
        var bMousePresent = window.external.CheckMouse();
        if ((0 == bKeyboardPresent) || (0 == bMousePresent))
        {
            if ((0 == bKeyboardPresent) && (0 == bMousePresent))
            {
                Navigate("setup\\nousbkm.htm");
            }
            else if (0 == bKeyboardPresent)
            {
                Navigate("setup\\nousbkbd.htm");
            }
            else  
            {
                Navigate("setup\\nousbms.htm");
            }
            break;
        }

        

    case CKPT_WELCOME:
        trace("GoNavigate: CKPT_WELCOME");
        if (!window.external.GetNoWelcomeFinish())
        {
            PushCKPT(CKPT_WELCOME); 
            Navigate(URLFromCKPT(CKPT_WELCOME));
            break;
        }
        

    case CKPT_OOBEDISC:
        trace("GoNavigate: CKPT_OOBEDISC");
        if (1 == DirObj.get_ShowOOBEDisc())
        {
            PushCKPT(CKPT_OOBEDISC);
            Navigate(URLFromCKPT(CKPT_OOBEDISC));
            break;
        }
        

    case CKPT_MOUSETUT1:
        trace("GoNavigate: CKPT_MOUSETUT1");
        var MT_INIstr=DirObj.get_DoMouseTutorial();
        if ((MT_INIstr.length>0) && (MT_INIstr=="2"))
        {
            PushCKPT(CKPT_MOUSETUT1);
            Navigate(URLFromCKPT(CKPT_MOUSETUT1));
            break;
        }

        

    case CKPT_IMETUTORIAL:
        trace("GoNavigate: CKPT_IMETUTORIAL");
        if ((1 == DirObj.get_DoIMETutorial()) && g_IMEExists)
        {
            PushCKPT(CKPT_IMETUTORIAL);
            Navigate(URLFromCKPT(CKPT_IMETUTORIAL));
            break;
        }

        

    case CKPT_OEMHW:
        trace("GoNavigate: CKPT_OEMHW");
        if (1 == DirObj.get_DoOEMHardwareCheck())
        {
            PushCKPT(CKPT_OEMHW);
            Navigate(URLFromCKPT(CKPT_OEMHW));
            break;
        }

        

    case CKPT_REGION_KEYBD:
        trace("GoNavigate: CKPT_REGION_KEYBD");
        //if (1 == DirObj.get_DoRegionalKeyboard() && !StatusObj.get_Status(LANGUAGECOMPLETED))
        //{
            PushCKPT(CKPT_REGION_KEYBD);
            Navigate(URLFromCKPT(CKPT_REGION_KEYBD));
            break;
        //}

        
        
        //if ( 0 == DirObj.get_DoRegionalKeyboard() &&
        //     ! window.external.get_RetailOOBE()
        //     ) {

        //   LangObj.SaveSettings();
        //}

        

    case CKPT_TIMEZONE:
        trace("GoNavigate: CKPT_TIMEZONE");
       // var TimeZonewasSet=SysClockObj.get_TimeZonewasPreset();

        
        

        //if ((!TimeZonewasSet &&
        //            ((1 == DirObj.get_DoTimeZone()) || (DirObj.get_TimeZoneValue() != ""))))
        //{
            PushCKPT(CKPT_TIMEZONE);
            Navigate(URLFromCKPT(CKPT_TIMEZONE));
            break;
        //}

        

    case CKPT_EULA:
        trace("GoNavigate: CKPT_EULA");
        if (null == EulaObj)
        {
            EulaObj = new Object;
            EulaObj = window.external.Eula;
        }

        
        
        if (!EulaObj.get_EULAAcceptance && 0 == window.external.get_RetailOOBE() )
        {
            PushCKPT(CKPT_EULA);
            Navigate(URLFromCKPT(CKPT_EULA));
            break;
        }

        

    case CKPT_PRODUCTKEY:
        trace("GoNavigate: CKPT_PRODUCTKEY");
        if (null == PidObj)
        {
            PidObj = new Object;
            PidObj = window.external.ProductID;
        }

        
        
        if (
                0 == window.external.get_RetailOOBE() &&
                0 == window.external.IsSelectVariation() &&
               (0 == PidObj.get_PID.length || !PidObj.ValidatePID)
            )
        {
            PushCKPT(CKPT_PRODUCTKEY);  
            Navigate(URLFromCKPT(CKPT_PRODUCTKEY));
            break;
        }

        

   // case CKPT_AUTO_UPDATE:
   //     trace("GoNavigate: CKPT_AUTO_UPDATE");
   //     if (null == AutoUpdateObj)
   //     {
   //         AutoUpdateObj = new Object;
   //         AutoUpdateObj = window.external.AutoUpdate;
   //     }

        
   //     if ( AutoUpdateObj.get_ShowUI() )
   //     {
   //         PushCKPT(CKPT_AUTO_UPDATE);
   //         Navigate(URLFromCKPT(CKPT_AUTO_UPDATE));
   //         break;
   //     }

        

    case CKPT_COMPNAME:
        trace("GoNavigate: CKPT_COMPNAME");

        if (window.external.GetSystemMetrics(SM_STARTER))
        {
            CompName_ChangeComplete(false);
            
        }
        else
        {
            
            
            
            if (window.external.get_RetailOOBE())
            {
                CompName_ChangeComplete(false);
                
            }
            else if (!g_CompNameChangeComplete)
            {
                PushCKPT(CKPT_COMPNAME);
                Navigate(URLFromCKPT(CKPT_COMPNAME));
                break;
            }
        }

        

    case CKPT_SECPASS:
        trace("GoNavigate: CKPT_SECPASS");

        
        
        //if ( null == g_AdminPassword &&
        //     window.external.IsProfessionalSKU() &&
        //     0 == window.external.get_RetailOOBE() &&
        //     1 == DirObj.get_DoAdminPassword()
        //    ) {
            PushCKPT(CKPT_SECPASS);
            Navigate(URLFromCKPT(CKPT_SECPASS));
            break;
        //}

        

    case CKPT_JNDOMAIN:
        trace("GoNavigate: CKPT_JNDOMAIN");

      //  if (!window.external.GetNoWelcomeFinish() &&
      //      (1 == DirObj.get_DoJoinDomain()) )
      //  {
            
            
      //      if ( !g_DomainDone && window.external.IsProfessionalSKU() &&
      //           0 == window.external.get_RetailOOBE() && HasNetwork()
      //          ) {
                PushCKPT(CKPT_JNDOMAIN);
                Navigate(URLFromCKPT(CKPT_JNDOMAIN));
                break;
      //      }
      //  }
        

    case CKPT_SCONNECT:
        trace("GoNavigate: CKPT_SCONNECT");
        if (!window.external.GetNoWelcomeFinish())
        {
            
            
            

            if (   DisplayIcsCongratsPage
                && UseIcs()
                && !g_bIsSetupUpgrade
                )
            {
                
                

                
                
                GoNavigate(CKPT_ACTIVATION);
                break;
            }
        }
        

    case CKPT_HOMENETWIZPROMPT:
        trace("GoNavigate: CKPT_HOMENETWIZPROMPT");
        if (!window.external.GetNoWelcomeFinish())
        {
            if (!g_bIsSetupUpgrade)
            {
                if ((CanConfigLan() == CONFIG_LAN_NO) && HasIndeterminateLan())
                {
                    PushCKPT(CKPT_HOMENETWIZPROMPT);
                    Navigate(URLFromCKPT(CKPT_HOMENETWIZPROMPT));
                    break;
                }
            }
        }
        

    case CKPT_ICSCHOICE:
        trace("GoNavigate: CKPT_ICSCHOICE");
        if (!window.external.GetNoWelcomeFinish())
        {
            if (!g_bIsSetupUpgrade)
            {
                if (CanConfigLan() != CONFIG_LAN_NO)
                {
                    
                    if (g_status != STATUS_OFF)
                    {
                        
                        
                        PushCKPT(CKPT_ICSCHOICE);
                        Navigate(URLFromCKPT(CKPT_ICSCHOICE));
                        break;
                    }
                }
            }
        }
        
        
    case CKPT_ACTIVATION:
        trace("GoNavigate: CKPT_ACTIVATION");
        
        
        if ( !window.external.GetNoWelcomeFinish() &&
             ((UseNetwork() || UseModem())
               && (g_ActivationRequired)
               && (g_status != STATUS_OFF) )
            )
        {
            PushCKPT(CKPT_ACTIVATION);
            Navigate(URLFromCKPT(CKPT_ACTIVATION));
            break;
        }

        

    case CKPT_REGISTER1:
        trace("GoNavigate: CKPT_REGISTER1");
        
        if ( !window.external.GetNoWelcomeFinish() &&
            (   (UseNetwork() || UseModem())
            && !window.external.get_RegStatus()
            && 1 != StatusObj.get_Status(MS_REGISTRATION)
            && 1 != StatusObj.get_Status(OEM_REGISTRATION)
            && (g_status != STATUS_OFF) )
            )
        {
            PushCKPT(CKPT_REGISTER1);
            Navigate(URLFromCKPT(CKPT_REGISTER1));
            break;
        }

        

    case CKPT_ICONN:
        trace("GoNavigate: CKPT_ICONN");
        if ( !window.external.GetNoWelcomeFinish() &&
             !g_bIsSetupUpgrade)
        {
            if ( (STATUS_ISP == g_status) && UseAnalogModem())
            {
                PushCKPT(CKPT_ICONN);
                Navigate(URLFromCKPT(CKPT_ICONN));
                break;
            }
        }

        

    case CKPT_ISPSIGNUP:
        trace("GoNavigate: CKPT_ISPSIGNUP");

        if ( !window.external.GetNoWelcomeFinish() &&
             (STATUS_ISP == g_status))
        {
            if ( (!g_bIsSetupUpgrade && UseAnalogModem()) ||
                  (g_bIsSetupUpgrade &&
                     ((!ConnectedToInternetEx(false) && HasAnalogModem()) ||
                       UseAnalogModem())
                  )
               )
            {
                PushCKPT(CKPT_ISPSIGNUP);
                Navigate(URLFromCKPT(CKPT_ISPSIGNUP));
                break;
            }
        }
        

        
        
        
    case CKPT_OEMISP:       
        trace("GoNavigate: CKPT_OEMISP");

        if (!g_bIsSetupUpgrade)
        {
            if ( (STATUS_PRECONFIG == g_status) && !window.external.GetNoIspPreconfig())
            {
                ResetDialing();
                PushCKPT(CKPT_OEMISP);
                Navigate(URLFromCKPT(CKPT_OEMISP));
                break;
            }
        }

        

    case CKPT_OEMCUST:

        trace("GoNavigate: CKPT_OEMCUST");
        
        

        Agent_TurnOffISPSpecialCommands();

        ResetDialing();
        if (1 == DirObj.get_OEMCust)
        {
            PushCKPT(CKPT_OEMCUST);
            Navigate(URLFromCKPT(CKPT_OEMCUST));
            break;
        }
        

        
        

    case CKPT_IDENTITIES2:
        trace("GoNavigate: CKPT_IDENTITIES2");
      //  if (window.external.GetSystemMetrics(SM_STARTER) == 0)
      //  {
      //      if (!window.external.GetNoWelcomeFinish())
      //      {
      //          IspAccountObj.Check();

      //          if (NeedToCreateAccount())
      //          {
                    PushCKPT(CKPT_IDENTITIES2);
                    Navigate(URLFromCKPT(CKPT_IDENTITIES2));
                    break;
      //          }
      //          else
      //          {
      //              InfoObj.set_UseIdentities(false);
      //          }
      //      }
      //  }
        

    case CKPT_DONE:
        trace("GoNavigate: CKPT_DONE");
        ResetDialing();
        if (!window.external.GetNoWelcomeFinish())
        {
            PushCKPT(CKPT_DONE);
            Navigate(URLFromCKPT(CKPT_DONE));
        }
        else
        {
            PushCKPT(CKPT_DONE);
            GoNext();
        }
        break;

    default:
        trace("GoNavigate: default (" + ckptGoHere + ")");
        PushCKPT(ckptGoHere);  
        Navigate(URLFromCKPT(ckptGoHere));
        break;
    }

    StatusNavigate();

    

    Agent_OnNavigate();
}

















function GoNext()
{
    try
    {
        if (IsLocalFile() && g.event == null)
            return;
    }
    catch(e)
    {
        return;
    }

    DisableAllButtons();

    switch (g_CurrentCKPT)
    {
    case CKPT_ANIMATION:
        try
        {
            IntroAnimation.Controls.Stop();
            IntroAnimation.style.visibility = "hidden";
        }
        catch(err)
        {
            var temp = "EXCEPTION THROWN: WMP control failed to stop.";
            temp += "\rerror name: " + err.name;
            temp += "\rmessage: " + err.message;
            temp += "\rnumber: " + err.number;
            temp += "\rdescription: " + err.description;
            trace(temp);
        }
        MovieFrame.style.display = "none";
        GoNavigate(CKPT_HWCHK);
        break;

    case CKPT_HWCHK:
        GoNavigate(CKPT_HWCHK);
        break;

    case CKPT_WELCOME:
        g_DidWePassWelcomePage = true;
        g.document.body.style.cursor = "wait";
        window.setTimeout("GoNavigate(CKPT_OOBEDISC);",50);
        break;

    case CKPT_OOBEDISC:
        g.document.body.style.cursor = "wait";
        window.setTimeout("GoNavigate(CKPT_MOUSETUT1);",50);
        break;

    case CKPT_MOUSETUT1:
        GoNavigate(CKPT_IMETUTORIAL);
        break;

    case CKPT_IMETUTORIAL:
        GoNavigate(CKPT_OEMHW);
        break;

    case CKPT_OEMHW:
        GoNavigate(CKPT_REGION_KEYBD);
        break;

    case CKPT_REGION_KEYBD:
        
        
        g.selKeyboard.disabled = true;
        g.selKeyboard.onchange = null;
        g.selRegion.disabled = true;
        g.selRegion.onchange   = null;
        g.selLang.disabled = true;
        g.selLang.onchange     = null;

        g.document.body.style.cursor = "wait";

        LangObj.set_RegionIndex(g.selRegion.selectedIndex)
            LangObj.set_LangIndex(g.selLang.selectedIndex);
        LangObj.set_KeyboardLayoutIndex(g.selKeyboard.selectedIndex);

        
        
        LangObj.SaveSettings();

        if (LANGUAGE_REBOOT_NOW == LangObj.get_RebootState())
            GoNavigate(CKPT_REGKB_COMMIT);
        else
            GoNavigate(CKPT_TIMEZONE);

        g.document.body.style.cursor = "default";

        break;

    case CKPT_REGKB_COMMIT:
        

        PopCKPT(CKPT_REGKB_COMMIT); 
        PopCKPT(CKPT_REGION_KEYBD);
        PushCKPT(CKPT_TIMEZONE); 
                                 
        StatusObj.set_Status(LANGUAGECOMPLETED, true);
        window.external.PowerDown(POWERDOWN_REBOOT);
        break;

    case CKPT_TIMEZONE:
        g_daylight = g.daylight.checked;
        g_CurTimeZoneIdx = g.selTimeZone.selectedIndex;
        ApiObj.set_RegValue(HKEY_LOCAL_MACHINE, OOBE_MAIN_REG_KEY + "\\TEMP", "TimeZoneSaved", 1);
        ApiObj.set_RegValue(HKEY_LOCAL_MACHINE, OOBE_MAIN_REG_KEY + "\\TEMP", "TimeZoneIdx", g_CurTimeZoneIdx);
        ApiObj.set_RegValue(HKEY_LOCAL_MACHINE, OOBE_MAIN_REG_KEY + "\\TEMP", "DayLight", g_daylight);
        GoNavigate(CKPT_EULA);
        break;

    case CKPT_EULA:
        if (EulaObj.get_EULAAcceptance)
        {
            PopCKPT();
            GoNavigate(CKPT_PRODUCTKEY);
        }
        else
            GoNavigate(CKPT_EULA_DECLINE);
        break;

    case CKPT_EULA_DECLINE:
        PopCKPT();
        PushCKPT(CKPT_EULA);  
        window.external.PowerDown(POWERDOWN_SHUTDOWN);
        break;

    case CKPT_PRODUCTKEY:
        StorePid();

        if (PidObj.get_PID.length != 0 && PidObj.ValidatePID())
        {
            window.external.ResetLicenseAgent();
            PopCKPT(CKPT_PRODUCTKEY);
            //GoNavigate(CKPT_AUTO_UPDATE);
			GoNavigate(CKPT_COMPNAME);
        }
        else
        {
            GoNavigate(CKPT_BADPRODUCTKEY);
        }
        break;

    case CKPT_BADPRODUCTKEY:
        PopCKPT();  
        PushCKPT(CKPT_PRODUCTKEY);  
        window.external.PowerDown(POWERDOWN_SHUTDOWN);
        break;

    //case CKPT_AUTO_UPDATE:
		//if (null == AutoUpdateObj)
        //{
        //   AutoUpdateObj = new Object;
        //    AutoUpdateObj = window.external.AutoUpdate;
        //}

        
        //if (0 == AutoUpdateObj.get_ShowUI())
        //{
        //    PopCKPT();        
        //}
        //GoNavigate(CKPT_COMPNAME);
        //break;

    case CKPT_COMPNAME:
        g.document.body.style.cursor = "wait";
        if (COMPNAME_INVALIDNAME == CompName_OnNext())
        {
            g.document.body.style.cursor = "default";
        }
        break;

    case CKPT_SECPASS:
        g_AdminPassword = g.SecurityPass.value;
        //window.external.SetAdminPassword(
        //    "",
        //    g_AdminPassword
        //    );
		SetAdminPassword(g_AdminPassword);		
        PopCKPT();
        GoNavigate(CKPT_JNDOMAIN);
        break;

    case CKPT_JNDOMAIN:

        window.external.JoinDomain(
           g_DomainName,
           g_DomainUser,
           g_DomainPass,
           g_Domain ? 1 : 0
           );

        g_DomainDone = true;

        PopCKPT();
        GoNavigate(CKPT_SCONNECT);
        break;

    case CKPT_ICSCHOICE:
        if (CanConfigLan() == CONFIG_LAN_YES)
        {
            if (GetPublicLanCount() != 0)
            {
                if (window.external.GetSystemMetrics(SM_STARTER) == 0)
                {
                    if (g.radio_ChooseDSLCable.checked)
                    {
                        
                        
                        window.external.FirewallPreferredConnection(false);
                    }
                    else if (g.radio_ChooseLAN.checked)
                    {
                        
                        window.external.FirewallPreferredConnection(true);
                    }
                }
                else
                {
                    
                    window.external.FirewallPreferredConnection(true);
                }

                GoNavigate(CKPT_ACTIVATION);
            }
            else
            {
                
                
                if (g.radio_ChooseDSLCable.checked)
                {
                    g_fFirewallRequired = true;
                    GoNavigate(CKPT_DSLMAIN);
                }
                else if (g.radio_ChooseLAN.checked)
                {
                    
                    g_fFirewallRequired = false;
                    GoNavigate(CKPT_DSLBROADBAND);
                }
                else if (g.radio_ChooseModem.checked)
                {
                    g_fFirewallRequired = false;
                    SetPreferredConnection(CONNECTIONTYPE_MODEM);
                    GoNavigate(CKPT_ACTIVATION);
                }
            }
        }
        else
        {
            PopCKPT(CKPT_ICSCHOICE);
            GoNavigate(CKPT_HOMENETWIZPROMPT);
        }
        break;

    case CKPT_DSLMAIN:
        if (g.dsltypeform.radioDSLYes.checked)
        {
            GoNavigate(CKPT_DSLPPPOE);
        }
        else
        {
            GoNavigate(CKPT_DSLBROADBAND);
        }
        break;

    case CKPT_DSLPPPOE:
        if (dsl_pppoe_OnNext())
        {
            PopCKPT();
            GoNavigate(CKPT_ACTIVATION);
            
        }
        else
        {
            
            
            dsl_pppoe_LoadMe();
        }
        break;

    case CKPT_DSLBROADBAND:
        if (dsl_broadband_OnNext())
        {
            PopCKPT();
            GoNavigate(CKPT_ACTIVATION);
            
        }
        else
        {
            
            
            dsl_broadband_LoadMe();
        }
        break;

    case CKPT_SCONNECT:
        
        GoNavigate(CKPT_ACTIVATION);
        break;

    case CKPT_CONGRATS:
        PopCKPT(CKPT_CONGRATS);
        PopCKPT(CKPT_DSLMAIN);
        GoNavigate(CKPT_ACTIVATION);
        break;

    case CKPT_HOMENETWIZPROMPT:
        
        
        GoNavigate(CKPT_ACTIVATION);
        break;

    case CKPT_ACTIVATION:
        
        
        
        
        
        if (g.rb_act_1.checked)
        {
            g_DoActivation = true;
            g_fRegWithMS=true;
            GoNavigate(CKPT_REGISTER1);
        }
        else
        {
            g_DoActivation = false;
            g_fRegWithMS=false;
            if (1 == RegisterObj.get_PostToOEM)
                GoNavigate(CKPT_REGISTER1);
            else
                GoNavigate(CKPT_ICONN);
        }
        break;

    case CKPT_REGISTER1:
        if (g_fRegWithMS)
        {
            if (g.rb_reg_ms_yes.checked)
                g_PostToMS=true;
            else
                g_PostToMS=false;
        }
        else
        {
            g_PostToMS=false;
        }

        if (1 == RegisterObj.get_PostToOEM)
        {
            if (g.rb_reg_oem_yes.checked)
                g_PostToOEM=true;
            else
                g_PostToOEM=false;
        }
        else
        {
            g_PostToOEM=false;
        }
        Reg1SaveRadioState();

        if (g_PostToMS || g_PostToOEM)
        {
            GoNavigate(CKPT_REGISTER3);
        }
        else if ( !g_DoActivation )
        {
            GoNavigate(CKPT_ICONN);
        }
        else if (UseNetwork())
        {
            LanActReg();
        }
        else if (UseModem())
        {
            GoNavigate(CKPT_REGDIAL);
        }
        else
        {
            
            
            
            trace("GoNext: CKPT_REGISTER1 - ERROR: Unable to connect to internet.");
            GoNavigate(CKPT_ICONN);
        }
        break;

    case CKPT_REGISTER3:
        trace("GoNext: CKPT_REGISTER3");
        var L_Reg3Title_Text = "Submitting Registration Information ...";
        if(VerifyReg3Fields())
        {
            Reg3SaveSettings();

            Save_Registered_owner(g.UserFirstName.value, g.UserLastName.value);

            if (UseNetwork())
            {
                LanActReg();
            }
            else
            {
                GoNavigate(CKPT_REGDIAL);
            }
        g.document.body.style.cursor = "wait";
        g.sharems.disabled = true;
        g.firstname.disabled = true;
        g.lastname.disabled = true;
        g.Address.disabled = true;
        g.Address2.disabled = true;
        g.City.disabled = true;
        g.State.disabled = true;
        g.Zipcode.disabled = true;
        g.Email.disabled = true;
        g.selCountry.disabled = true;
        g.selCAProvince.disabled = true;
        g.selUSState.disabled = true;
        g.Reg3Title.innerHTML = L_Reg3Title_Text;
        }
        break;

    case CKPT_ACT_MSG:
        PopCKPT();
        GoNavigate(CKPT_ICONN);
        break;

    case CKPT_ICONN:
        if (g.radioYesIconn.checked)
        {
            GoNavigate(CKPT_ISPSIGNUP);
        }
        else if (g.radioNoIconn.checked)
        {
            GoNavigate(CKPT_OEMCUST);
        }
        break;

    case CKPT_ISPSIGNUP:
        trace("GoNext: CKPT_ISPSIGNUP");


        if (g.radioGetNewISP.checked)
        {
            if (window.external.CheckOnlineStatus && window.external.CheckStayConnected("msobe.isp"))
            {
                PushCKPT(CKPT_ISPDIAL);
                g_IgnoreDialErr = false;
                window.external.Connect(CONNECTED_ISP_SIGNUP, "msobe.isp");
            }
            else
            {
                window.external.Hangup();
                GoNavigate(CKPT_ISPDIAL); 
            }
        }
        else if ((g.radioMigrateISP != null) && g.radioMigrateISP.checked)
        {
            
            
            if (!DirObj.get_ShowISPMigration())
            {
                if (window.external.CheckOnlineStatus && window.external.CheckStayConnected("migrate.isp"))
                {
                    g_bTapiDone = false;
                    GoNavigate(CKPT_REFDIAL);
                }
                else
                {
                    window.external.Hangup();
                    GoNavigate(CKPT_REFDIAL);
                }
            }
            else
            {
                GoNavigate(CKPT_ICONNECT);
            }
        }
        else
        {
            GoCancel();  
        }

        break;

    case CKPT_REFDIAL:
        GoNavigate(CKPT_ICONNECT);
        break;

    case CKPT_ICONNECT:
        GoNavigate(CKPT_OEMCUST);
        break;

    case CKPT_ISPDIAL:
        GoNavigate(CKPT_OEMCUST);
        break;

    case CKPT_REGDIAL:
        GoNavigate(CKPT_ICONN);
        break;

    case CKPT_OEMISP:
        GoNavigate(CKPT_OEMCUST);
        break;

    case CKPT_OEMCUST:
        GoNavigate(CKPT_IDENTITIES2);
        break;

    case CKPT_IDENTITIES2:
        if (window.external.GetSystemMetrics(SM_STARTER) == 0)
        {
            Identities2_OnLeave();
            if (g_Identities2_OK)
            {
                
                
                
                if (!g_RegisteredOwnerDone)
                {
                    Save_Registered_owner(g.txtUser.item(g_NameToSaveIndex).value);
                }
                InfoObj.set_UseIdentities(true);
                GoNavigate(CKPT_DONE);
            }
            else
            {
                Identities2_LoadMe();
            }
        }
        else
        {
            GoNavigate(CKPT_DONE);
        }
        break;

    case CKPT_DONE:
        g.document.body.style.cursor = "wait";

        var finish = window.external.Finish();
        g.document.body.style.cursor = "default";

        if (finish == FINISH_OK || finish == FINISH_REBOOT)
        {
            if (IspAccountObj.HasSignUp() && InfoObj.get_UseIdentities())
            {
                
                
                
                

                var Identity0 = InfoObj.get_Identity(0);
                var ProfileName = InfoObj.get_DefaultNewUser();
                if ((Identity0 != null) && (Identity0 != "") &&
                    (ProfileName != null) && (ProfileName != ""))
                {
                    IspAccountObj.SetProfileName(ProfileName);
                }
            }
            
            SysClockObj.set_AutoDaylight(g_daylight);
            if (SysClockObj.set_TimeZoneIdx(g_CurTimeZoneIdx))
            {
                finish = FINISH_REBOOT;
            }

        }

        if (finish == FINISH_REBOOT) 
        {
            window.external.PowerDown(POWERDOWN_REBOOT);
        }
        else if (finish != FINISH_OK)
        {
            
            

            EmptyCKPTStack();

            if (finish & FINISH_BAD_PID)
            {
                GoNavigate(CKPT_PRODUCTKEY);
            }
            else if (finish & FINISH_BAD_EULA)
            {
                GoNavigate(CKPT_EULA);
            }
            else
            {
                
                
                GoNavigate(CKPT_WELCOME);
            }
        }

        break;

    default:
        
        GoNavigate(Need_to_handle_this_CKPT_in_GoNext);
        break;
    }
}



function GoOffline()
{
    GoNext();
}


function GetCurrentPageName() {

    var re = new RegExp("\\\\([^\\\\]+)$");
    re.exec(g.window.location.pathname);

    return RegExp.$1;
}


function SimpleNavBack()
{
    g.window.history.back();
}






function SimpleNavNext()  
{
    var CurPage = GetCurrentPageName();
    var NextPage = g_SimpleNavMap.Item(CurPage);
    Navigate(NextPage);
}







function DisableAllButtons()
{
    try
    {
        if(g.btnNext!=null)
        {
            g.btnNext.onclick=null;
        }
    } catch (e) {}

    try
    {
        if(g.btnBack!=null)
        {
            g.btnBack.onclick=null;
        }
    } catch (e) {}

    try
    {
        if(g.btnSkip!=null)
        {
            g.btnSkip.onclick=null;
        }
    } catch (e) {}

    try
    {
        g.btnNext.disabled=true;
        g.btnNext.className="newbuttonsNext-disabled";
    }
    catch(e) {}
    try
    {
        g.btnBack.disabled=true;
        g.btnBack.className="newbuttonsBack-disabled";
    }
    catch(e) {}
    try
    {
        g.btnSkip.disabled=true;
        g.btnSkip.className="newbuttonsSkip-disabled";
    }
    catch(e) {}
}












function InitFrameRef(ExternalModule)
{
    trace("GoNext: InitFrameRef");
    try
    {
        document.frames("connDelay").frameElement.style.display="none";
        document.frames("connDelay").frameElement.style.zIndex=-1;
        
        
        
        OOBEDocBody.style.backgroundColor="#000000";
    }
    catch (e)
    {
    }

    g_LastButtonText = null;
    g_FirstFocusElement = null;
    g_LastKeyDown = null;

    g = document.frames("msoobeMain");
    try
    {
        g.document.body.style.backgroundColor = "transparent";
    }
    catch(e){}

    try
    {
        if (g != null)
        {
            if(g.btnNext!=null)
                g.btnNext.disabled=false;

            if(g.btnBack!=null)
                g.btnBack.disabled=false;

            if(g.btnSkip!=null)
                g.btnSkip.disabled=false;
        }

        g.document.body.onkeydown = OnKeyDown;
        g.document.body.style.cursor = 'auto';
    }
    catch(e){}

}

function HideButtons(buttons)
{
    if (null != g.btnBack && (buttons & HIDE_BACK))
    {
        g.btnBack.Hide = true;
    }

    if (null != g.btnNext && (buttons & HIDE_NEXT))
    {
        g.btnNext.Hide = true;
    }


    if (null != g.spanCancel && (buttons & HIDE_CANCEL))
    {
        g.btnSkip.Hide = true;
    }
    





}


function HandleButtonMouseOver()
{
    if((!this.disabled)&&(this.tagName=="BUTTON"))
        this.className="buttons-hover";
}

function HandleButtonMouseOut()
{
    if((!this.disabled)&&(this.tagName=="BUTTON"))
        this.className="buttons";
}

function InitButtons(SimpleBack, SimpleNext)
{
    
    
    
    if (!InReminderMode())
    {
        InitNewButtons(SimpleBack, SimpleNext);
    }
    else
    {
        if(g.btnSkip!=null) {
            g.btnSkip.onmouseover = HandleButtonMouseOver;
            g.btnSkip.onmouseout  = HandleButtonMouseOut;

            if(!g.btnSkip.disabled) {
                g.btnSkip.onclick = GoCancel;

                
                
                

                g.btnSkip.className="buttons";
            } else {
                g.btnSkip.className="buttons-disabled";
            }
        }

        if (g.btnNext != null)
        {
            g.btnNext.onmouseover = HandleButtonMouseOver;
            g.btnNext.onmouseout  = HandleButtonMouseOut;

            if (!g.btnNext.disabled)
            {
                if (SimpleNext == null)
                {
                    g.btnNext.onclick = GoNext;
                }
                else
                {
                    g.btnNext.onclick = SimpleNavNext;
                }

                g.btnNext.className="buttons";
            }
            else
            {
                g.btnNext.className="buttons-disabled";
            }
        }

        if (g.btnBack != null)
        {
            g.btnBack.onmouseover = HandleButtonMouseOver;
            g.btnBack.onmouseout  = HandleButtonMouseOut;

            if (!g.btnBack.disabled)
            {
                if (SimpleBack == null)
                {
                    g.btnBack.onclick = GoBack;
                }
                else
                {
                    g.btnBack.onclick = SimpleNavBack;
                }

                g.btnBack.className="buttons";
            }
            else
            {
                g.btnBack.className="buttons-disabled";
            }
        }
    }
}




function HandleBackButtonMouseOver()
{
    if((!this.disabled)&&(this.tagName=="BUTTON"))
        this.className="newbuttonsBack-hover";
}

function HandleBackButtonMouseOut()
{
    if((!this.disabled)&&(this.tagName=="BUTTON"))
        this.className="newbuttonsBack";
}

function HandleBackButtonMouseDown()
{
    if((!this.disabled)&&(this.tagName=="BUTTON"))
        this.className="newbuttonsBack-down";
}

function HandleSkipButtonMouseOver()
{
    if((!this.disabled)&&(this.tagName=="BUTTON"))
        this.className="newbuttonsSkip-hover";
}

function HandleSkipButtonMouseOut()
{
    if((!this.disabled)&&(this.tagName=="BUTTON"))
        this.className="newbuttonsSkip";
}

function HandleSkipButtonMouseDown()
{
    if((!this.disabled)&&(this.tagName=="BUTTON"))
        this.className="newbuttonsSkip-down";
}

function HandleNextButtonMouseOver()
{
    if((!this.disabled)&&(this.tagName=="BUTTON"))
        this.className="newbuttonsNext-hover";
}

function HandleNextButtonMouseOut()
{
    if((!this.disabled)&&(this.tagName=="BUTTON"))
        this.className="newbuttonsNext";
}

function HandleNextButtonMouseDown()
{
    if((!this.disabled)&&(this.tagName=="BUTTON"))
        this.className="newbuttonsNext-down";
}


function InitNewButtons(NewSimpleBack, NewSimpleNext)
{

    if(g.btnSkip!=null)
    {
        g.btnSkip.onmouseover = HandleSkipButtonMouseOver;
        g.btnSkip.onmouseout  = HandleSkipButtonMouseOut;
        g.btnSkip.onmousedown = HandleSkipButtonMouseDown;

        if(!g.btnSkip.disabled)
        {
            g.btnSkip.onclick = GoCancel;
            g.btnSkip.className="newbuttonsSkip";
        }
        else
        {
            g.btnSkip.className="newbuttonsSkip-disabled";
        }
    }

    if (g.btnNext != null)
    {
        g.btnNext.onmouseover = HandleNextButtonMouseOver;
        g.btnNext.onmouseout  = HandleNextButtonMouseOut;
        g.btnNext.onmousedown = HandleNextButtonMouseDown;

        if (!g.btnNext.disabled)
        {
            if (NewSimpleNext == null)
                g.btnNext.onclick = GoNext;
            else
                g.btnNext.onclick = SimpleNavNext;

            g.btnNext.className="newbuttonsNext";
        }
        else
        {
            g.btnNext.className="newbuttonsNext-disabled";
        }
    }

    if (g.btnBack != null)
    {
        g.btnBack.onmouseover = HandleBackButtonMouseOver;
        g.btnBack.onmouseout  = HandleBackButtonMouseOut;
        g.btnBack.onmousedown = HandleBackButtonMouseDown;

        if (!g.btnBack.disabled)
        {
            if (NewSimpleBack == null)
                g.btnBack.onclick = GoBack;
            else
                g.btnBack.onclick = SimpleNavBack;

            g.btnBack.className="newbuttonsBack";
        }
        else
        {
            g.btnBack.className="newbuttonsBack-disabled";
        }
    }
}

var g_LastKeyDown = null;
function OnKeyDown()
{
    try
    {
        if (IsLocalFile() && g.event == null)
            return;
    }
    catch(e)
    {
        return;
    }

    if (g.event.altKey)
    {
        g_LastKeyDown = String.fromCharCode(g.event.keyCode);
        if (g_LastKeyDown != null)
            g_LastKeyDown = g_LastKeyDown.toUpperCase();
    }
    else
        g_LastKeyDown = null;


    
    Agent_OnKeyDown(g.event.srcElement);
}



function OnSelectClick()
{
    Agent_OnSelectClick(g.event.srcElement);
}



function OnClick()
{
    Agent_OnElementClick(g.event.srcElement);
}



function OnFocus()
{
    

    Agent_OnFocus(g.event.srcElement);
}


function KeyPressIsNumeric()
{
    try
    {
        if (IsLocalFile() && g.event == null)
            return;
    }
    catch(e)
    {
        return;
    }

    if (!IsNumeric(g.event.keyCode))
    {
        g.event.keyCode = 0;
        g.event.returnValue = false;
    }
}

function IsNumeric(keyCode)
{
    if ((keyCode >= 48)  && (keyCode <= 57))
        return true;
    else
        return false;
}

function IsSpecial(keyCode)
{
    
    












    return false;
}

function KeyPressIsValid()
{
    try
    {
        if (IsLocalFile() && g.event == null)
            return;
    }
    catch(e)
    {
        return;
    }

    if (!IsAlpha(g.event.keyCode) &&
            !IsSpecial(g.event.keyCode) &&
            !IsNumeric(g.event.keyCode))
    {
        g.event.keyCode = 0;
        g.event.returnValue = false;
    }
}

function KeyPressIsAlpha()
{
    try
    {
        if (IsLocalFile() && g.event == null)
            return;
    }
    catch(e)
    {
        return;
    }

    if (!IsAlpha(g.event.keyCode))
    {
        g.event.keyCode = 0;
        g.event.returnValue = false;
    }
}

function IsAlpha(keyCode)
{
    
    








    
    
    return true;
    
    
}

function NumberOfSpaces(strValue)
{
    




    var iSpaceCount = 0;
    for (iPosition = 0; iPosition < strValue.length; iPosition ++)
    {
        if (strValue.charAt(iPosition) == ' ')
        {
            iSpaceCount++;
        }
    }
    return iSpaceCount;
}
function KeyCodeToUpper()
{
    var strKeyCode = String.fromCharCode(g.event.keyCode);
    strKeyCode = strKeyCode.toUpperCase();
    g.event.keyCode = strKeyCode.charCodeAt(0);
}



function FlashPlayerInstalled()
{
    var fReturn = false;
    try
    {
        
        
        
        
        
        
        strProgId = WshShell.RegRead("HKCR\\CLSID\\"
                + CLSID_FLASH_PLAYER
                + "\\VersionIndependentProgID\\");
        if (   PROGID_FLASH_PLAYER == strProgId
                && CLSID_FLASH_PLAYER  == WshShell.RegRead(  "HKCR\\"
                    + strProgId
                    + "\\CLSID\\")
           )
        {
            strInprocServer32 = WshShell.RegRead(  "HKCR\\CLSID\\"
                    + CLSID_FLASH_PLAYER
                    + "\\InprocServer32\\"
                                                );
            fReturn = FileSystemObj.FileExists(strInprocServer32);
        }

    }
    catch (err)
    {
        
        
        
        fReturn = false;
    }

    return fReturn;
}

function InitApplication()
{
    OOBEDocBody.style.cursor = "wait";  
    OOBEDocBody.style.backgroundColor="black";

    g_bStartup = true;
    InitFrameRef();

    
    
    var OEMLogoFile = null;
    OEMLogoFile = ApiObj.get_INIKey("branding", "oemlogo");
    if (  (OEMLogoFile != null)
       && (OEMLogoFile.length>0)
       && FileSystemObj.FileExists(g_OOBEDirPath+"images\\"+OEMLogoFile) )
    {
        spnOEMLogo.style.visibility="visible";
        spnOEMLogo.style.backgroundImage = 'url(images/' + OEMLogoFile + ')';
    }

    NewMicrosoftLogo.src = 'images/mslogo.jpg';

    g_bInHighScreenRes =
        (window.top.screen.width >= 1024) &&
        (window.top.screen.height >= 768);

    
    if (g_bInHighScreenRes)
    {

        NewWatermarkBackground.src = 'images/newmark1.jpg';
        NewWatermarkTop.src = 'images/newtop1.jpg';
        NewWatermarkBottom.src = 'images/newbtm1.jpg';
        NewWatermarkBottom.style.top = 712;

        ScreenFrame.style.width = 1024;
        ScreenFrame.style.height = 768;

        MainFrameTable.style.top = 28;
        MainFrameTable.style.height = "99%";

        document.frames("ifrmConnDelay").frameElement.style.left=0;

        spnOEMLogo.style.left = 749;
        spnAssist.style.top = 590;
        spnAssist.style.left = 815;
        spnAssist.style.width = 240;

    }
    else
    {

        NewWatermarkBackground.src = 'images/newmark8.jpg';
        NewWatermarkTop.src = 'images/newtop8.jpg';
        NewWatermarkBottom.src = 'images/newbtm8.jpg';
        NewWatermarkBottom.style.top = 542;

        
        
        ScreenFrame.style.width = 800;
        ScreenFrame.style.height = 600;

    }

    
    if (window.parent.document.dir == "rtl")
        spnAssist.style.left  = 10;

    var ScreenDiff = window.top.screen.width - parseInt(ScreenFrame.style.width);
    ScreenFrame.style.left = (ScreenDiff > 0) ? ScreenDiff / 2 : 0;

    ScreenDiff = window.top.screen.height - parseInt(ScreenFrame.style.height);
    ScreenFrame.style.top = (ScreenDiff > 0) ? ScreenDiff / 2 : 0;


    
    var L_MovieAlt_Text = "Welcome";
    var L_AgentAlt_Text = "Click me to get help";
    IntroAnimation.alt = L_MovieAlt_Text;
    AssistImg.alt = L_AgentAlt_Text;

    
    
    
    
    
    
    g_status = STATUS_OFF;
    window.external.LoadStatusItems("No Modem");

    InitCKPT();

    
    g_IMEExists = FileSystemObj.FileExists(ApiObj.get_SystemDirectory() + "\\OOBE\\HTML\\IME\\IMETut1.htm");

    Agent_Init();

    if ( 0 != window.external.get_RetailOOBE() )
    {
        EmptyCKPTStack();
    }

    g_bIsSetupUpgrade = window.external.IsUpgrade();

    spnPage.style.visibility = "visible";

    if (ApiObj.get_RegValue(HKEY_LOCAL_MACHINE, OOBE_MAIN_REG_KEY + "\\TEMP", "TimeZoneSaved") == 1)
    {
        g_CurTimeZoneIdx = ApiObj.get_RegValue(HKEY_LOCAL_MACHINE, OOBE_MAIN_REG_KEY + "\\TEMP", "TimeZoneIdx");
        g_daylight = ApiObj.get_RegValue(HKEY_LOCAL_MACHINE, OOBE_MAIN_REG_KEY + "\\TEMP", "DayLight");
    }

    if ( window.external.get_RetailOOBE() ||
         g_CurrentCKPT > CKPT_COMPNAME ||
         DirObj.get_IntroOnly()
         )
    {
        
        window.external.ComputerNameChangeComplete(false);
    }

    if ( !window.external.get_RetailOOBE() &&
         window.external.GetNoWelcomeFinish() )
    {
        ApiObj.OEMComputername();
        CompName_ChangeComplete(false);

        window.external.OEMPassword();
        
        
        g_AdminPassword = ""
    }

    
    
    g_ClickNextStrWelcome = "<table tabindex=-1 border=0 style=\"position:absolute; top: " + ((!g_bInHighScreenRes) ? L_ClickNextStrTopPercent800_Text : L_ClickNextStrTopPercent1024_Text) + "; left:2%; width:95%\"><tr>"
    +"<td class=\"text-primary\" ID=NextText nowrap>"+L_ContStr_Text+" <span class=\"emphasis-lesser\">"
    +L_NextStr_Text+"</span>"+L_ClickNextLocStr_Text+L_Period_Text+"</td><td width=90%>&nbsp;</td></tr></table>";

    
    
    
    
    var AnyPrefConnection = null;
    try
    {
        AnyPrefConnection = ApiObj.get_RegValue(HKEY_LOCAL_MACHINE, OOBE_MAIN_REG_KEY + "\\TEMP", PREFCONN_REG_VALUE);
    }
    catch(e){AnyPrefConnection = null}

    if (AnyPrefConnection == null)
        g_PreferredConnection = CONNECTIONTYPE_INVALID;
    else
        g_PreferredConnection = AnyPrefConnection;


    
    if (null == g_CurrentCKPT)
    {
        GoNavigate(CKPT_ANIMATION);
    }
    else
    {
        if (g_CurrentCKPT > CKPT_COMPNAME)
        {
            
            
            CompName_ChangeComplete(false);
        }

        OOBEDocBody.style.cursor = "default";
        ScreenFrame.style.display = "inline";

        GoNavigate(g_CurrentCKPT);
    }

    
    PlayBackgroundMusic();

    
    window.external.ShowOOBEWindow();
}

function InitStatusMenu()
{
    trace("InitStatusMenu");
    if ( (1 == DirObj.get_Offline() ||  false == InternetCapabilityExists() ))
    {
        g_status = STATUS_OFF;
        StatusObj.set_Status(NOLAUNCHISPSIGNUP, true);
        window.external.LoadStatusItems("No Modem");
    }
    else
    {
        if (UseIcs())
        {
            window.external.TriggerIcsCallback(true);
        }
        else
        {
            window.external.TriggerIcsCallback(false);
        }

        var str = DirObj.get_ISPSignup().toUpperCase();
        if ("MSN" == str)
        {
            g_status = STATUS_ISP;
            if ( window.external.get_RegStatus() )
                window.external.LoadStatusItems("MSN(No Reg)");
            else
                window.external.LoadStatusItems("MSN");
        }
        else if ("OFFLINE" == str)
        {
            g_status = STATUS_ISP;
            if ( window.external.get_RegStatus() )
                window.external.LoadStatusItems("Offline(No Reg)");
            else
                window.external.LoadStatusItems("Offline");
        }
        else if ("PRECONFIG" == str)
        {
            g_status = STATUS_PRECONFIG;
            if ( window.external.get_RegStatus() )
                window.external.LoadStatusItems("Preconfig(No Reg)");
            else
                window.external.LoadStatusItems("Preconfig");
        }
        else
        {
            g_status = STATUS_NONE;
            StatusObj.set_Status(NOLAUNCHISPSIGNUP, true);
            if ( window.external.get_RegStatus() )
                window.external.LoadStatusItems("None(No Reg)");
            else
                window.external.LoadStatusItems("None");
        }
    }
}


function ProcessQueuedEvents() {
    
    
    window.external.ProcessQueuedEvents();
}

function navigatetoEULA()
{
    Navigate("setup\\neweula2.htm");
}





function GetAncestorByTag(elem, tagName)
{
    if (elem == null || tagName == null)
    {
        return null;
    }

    var aNode = elem.parentNode;
    var tagNameUpperCase = tagName.toUpperCase();
    while (aNode != null && aNode.nodeName != tagNameUpperCase)
    {
        aNode = aNode.parentNode;
    }

    return aNode;
}

var g_bRadioMigrateISP=false;

var g_MSNISP=false;
var g_ExistISP=false;
var g_NoISP=false;

var L_RetailMSN_Text = "<b><u>G</u>et online with MSN </b><br>Select this option if you're a new or existing MSN member.";
var L_UpgradeSkip_Text = "<b><u>D</u>o not set up an Internet connection at this time</b><br>Select this option if you already have an Internet connection on your computer, or if you do not want to set up an MSN Internet connection at this time.";
var L_UpgradeSkipAccessKey_Text = "D";
function IspLoadMe()
{
    InitFrameRef();

    if (window.external.get_RetailOOBE())
    {
        g.ISP_New.innerHTML = L_RetailMSN_Text;
    }
    if (g_status == STATUS_ISP || g_status == STATUS_OFF)
    {
        if (window.external.GetSystemMetrics(SM_STARTER) == 0)
        {
        g.radioGetNewISP.style.display = "inline";
        g.ISP_New.style.display = "inline";
        g.radioGetNewISP.checked=true;
        g_FirstFocusElement = g.radioGetNewISP;
        }
        else
        {
        g.radioGetNewISP.style.display = "none";
        g.ISP_New.style.display = "none";
        g.radioMigrateISP.checked=true;
        g_FirstFocusElement = g.radioMigrateISP;
        }

        if (g_bIsSetupUpgrade)
        {
            var trMigrateISP = GetAncestorByTag(g.radioMigrateISP, "TR");
            var tableMigrateISP = GetAncestorByTag(trMigrateISP, "TABLE");
            if ((tableMigrateISP != null) && (trMigrateISP != null))
            {
                tableMigrateISP.deleteRow(trMigrateISP.rowIndex);
            }
            g.skipISP.accessKey = L_UpgradeSkipAccessKey_Text;
            g.skipISP.innerHTML = L_UpgradeSkip_Text;
        }
    }
    else
    {
        g.radioGetNewISP.style.display = "none";
        g.ISP_New.style.display = "none";
        g.radioMigrateISP.checked=true;
        g_FirstFocusElement = g.radioMigrateISP;
    }

    InitNewButtons();
    g_FirstFocusElement.focus();
}

function IspUnLoad()
{
    try
    {
        g_bRadioMigrateISP = (g.event.srcElement==g.radioMigrateISP);
    }
    catch (e) {}
}




function IcsLoadMe()
{
    InitFrameRef();
    InitNewButtons();

    if (CanConfigLan() == CONFIG_LAN_UNKNOWN)
    {
        g.title_ics0.style.display="inline";
        g.text_description_ics0.style.display="inline";
        g.img_status_ics0.style.display="inline";
        g.btnNext.className="newbuttonsNext-disabled";
        g.btnNext.disabled=true;

        CheckIfConfigLan("IcsLoadMe2()");
    }
    else
    {
        IcsLoadMe2();
    }
}

function IcsLoadMe2()
{
    if (!g || !g.title_ics0 || !g.title_ics1 || !g.title_ics2)
    {
        
        return;
    }

    if (CanConfigLan() == CONFIG_LAN_YES)
    {
        g.title_ics0.style.display="none";
        g.text_description_ics0.style.display="none";
        g.img_status_ics0.style.display="none";
        g.btnNext.disabled = false;
        g.btnNext.className="newbuttonsNext";

        g.radio_ics1.style.display="inline";
        if (window.external.GetSystemMetrics(SM_STARTER) == 0)
        {
            g.radio_ics2.style.display="inline";
        }

        if (GetPublicLanCount() != 0)
        {
            g.title_ics1.style.display="inline";
            g.text_description_ics1.style.display="inline";
            g.radio_description1_ics1.style.display="inline";
            g.text_description2_ics1.style.display="inline";
            if (window.external.GetSystemMetrics(SM_STARTER) == 0)
            {
                g.radio_description2_ics1.style.display="inline";
            }
            else
            {
                g.btnNext.disabled = false;
                g.btnNext.click();
            }
        }
        else
        {
            g.title_ics2.style.display="inline";
            g.text_description_ics2.style.display="inline";
            g.radio_description1_ics2.style.display="inline";
            g.radio_description1_ics2x.style.display="inline";
            if (window.external.GetSystemMetrics(SM_STARTER) == 0)
            {
                g.radio_description2_ics2.style.display="inline";
                g.radio_description2_ics2x.style.display="inline";
            }
            if (HasModem())
            {
                g.TXT_MODEM01.style.display="inline";
                g.TXT_MODEM02.style.display="inline";
                g.TXT_MODEM02x.style.display="inline";
                g.radio_ChooseModem.checked="true";
            }
        }

        g_FirstFocusElement = g.btnNext;
        g_FirstFocusElement.focus();
    }
    else
    {
        g.btnNext.disabled = false;
        g.btnNext.click();
    }
    
}



var g_YesIconn=false;
var g_NoIconn=false;

function IconnLoadMe()
{
    InitFrameRef();

    if(g_YesIconn) {
        g.radioYesIconn.checked=true;
    } else if(g_NoIconn){
        g.radioNoIconn.checked=true;
    }else {
        g.radioNoIconn.checked=false;
        g.radioYesIconn.checked=false;
    }

    g_FirstFocusElement = g.btnNext;
    g_FirstFocusElement.focus();
    g.btnBack.disabled=true;

    if(!(g.radioYesIconn.checked || g.radioNoIconn.checked))
        g.btnNext.disabled=true;

    g.radioYesIconn.onclick = Iconn_HandleClick;
    g.radioNoIconn.onclick = Iconn_HandleClick;

    InitNewButtons();
}

function Iconn_HandleClick()
{
    try
    {
        g_YesIconn = (g.event.srcElement==g.radioYesIconn);
        g_NoIconn = (g.event.srcElement==g.radioNoIconn);
        IconnRadioClicked();
    }
    catch (err)
    {
        logError("Iconn_HandleClick", err);
        throw err;
    }
}

function IconnRadioClicked()
{
    
    if(g.btnNext.disabled && (g.radioYesIconn.checked || g.radioNoIconn.checked))
      {
        g.btnNext.onmouseover = HandleNextButtonMouseOver;
        g.btnNext.onmouseout  = HandleNextButtonMouseOut;
        g.btnNext.onmousedown = HandleNextButtonMouseDown;
        g.btnNext.className="newbuttonsNext";
        g.btnNext.disabled = false;
        g.btnNext.onclick = GoNext;
        g.btnNext.focus();
    }
}





var g_cIdentitiesMax = InfoObj.get_IdentitiesMax();











function NeedToCreateAccount()
{
    try
    {
        
        
        if ( window.external.GetNetJoinStatus() == JOIN_STATUS_DOMAIN ) {
            trace("NeedToCreateAccount: Joining a domain");
            return false;
        }

        if (1 == InfoObj.get_OEMIdentities())
        {
            trace("NeedToCreateAccount: OEM identities are used");
            return false;
        }

        var iUserCount = window.external.GetLocalUserCount();
        if ( iUserCount > 1 ) {
            trace("NeedToCreateAccount: GetLocalUserCount returned " + iUserCount);
            return false;
        }

        return true;
    }
    catch (err)
    {
        logError("NeedToCreateAccount", err);
        throw err;
    }

    return true;
}



function Identities1_LoadMe()
{
    try
    {
        InitFrameRef();

        g_FirstFocusElement = g.btnNext;

        var MultipleIdentities = InfoObj.get_UseIdentities();
        if(MultipleIdentities) {
            g.radioMultipleIdentities.checked=true;
        } else {
            g.radioSingleIdentity.checked=true;
        }

        g.radioMultipleIdentities.onclick = Identities1_HandleClick;
        g.radioSingleIdentity.onclick = Identities1_HandleClick;

        InitNewButtons();

        if (g_FirstFocusElement != null)
            g_FirstFocusElement.focus();
    }
    catch (err)
    {
        logError("Identities1_LoadMe", err);
        throw err;
    }
}





function Identities1_HandleClick()
{
    try
    {
        var MultipleIdentities = (g.event.srcElement==g.radioMultipleIdentities);
        InfoObj.set_UseIdentities(MultipleIdentities);
    }
    catch (err)
    {
        logError("Identities1_HandleClick", err);
        throw err;
    }
}






var IspAccountObj = new IspAccount();

function IspAccount()
{
    this.REG_KEY = "\\ISPAccount";
    this.USERNAME_REG_VAL = "ISPUserName";
    this.USERFRIENDLYNAME_REG_VAL = "ISPUserFriendlyName";
    this.PROFILENAME_REG_VAL = "ProfileName";

    this.IspName = "";
    this.UserName = "";
    this.UserFriendlyName = "";
    this.SignUp = false;
    this.Init = false;
}

function IspAccountHasSignUp()
{
    if (this.Init == false)
    {
        this.Check();
        this.Init = true;
    }

    return this.SignUp;
}

IspAccount.prototype.HasSignUp = IspAccountHasSignUp;

function IspAccountCheck()
{
    this.SignUp = false;

    this.IspName = ApiObj.get_RegValue(HKEY_LOCAL_MACHINE,
                                       OOBE_MAIN_REG_KEY + this.REG_KEY,
                                       null);
    if (this.IspName)
    {
        this.UserName = ApiObj.get_RegValue(HKEY_LOCAL_MACHINE,
                                            OOBE_MAIN_REG_KEY + this.REG_KEY,
                                            this.USERNAME_REG_VAL);
        if (this.UserName)
        {
            this.SignUp = true;
            this.UserFriendlyName = ApiObj.get_RegValue(HKEY_LOCAL_MACHINE,
                                                        OOBE_MAIN_REG_KEY + this.REG_KEY,
                                                        this.USERFRIENDLYNAME_REG_VAL);
        }
    }

    return this.SignUp;
}

IspAccount.prototype.Check = IspAccountCheck;

function IspAccountSetProfileName(ProfileName)
{

    ApiObj.set_RegValue(HKEY_LOCAL_MACHINE,
                        OOBE_MAIN_REG_KEY + this.REG_KEY,
                        this.PROFILENAME_REG_VAL,
                        ProfileName);
}

IspAccount.prototype.SetProfileName = IspAccountSetProfileName;

var g_fFirstLoadIdentities = true;



function Identities2_LoadMe()
{
    if (window.external.GetSystemMetrics(SM_STARTER) == 0)
    {
        try
        {
            InitFrameRef();

            g_FirstFocusElement = g.txtUser.item(0);
            g_FirstFocusElement.focus(0);
            g_FirstFocusElement.select(0);

            if (g_fFirstLoadIdentities)
            {
                if (IspAccountObj.HasSignUp() &&
                IspAccountObj.UserFriendlyName != null &&
                IspAccountObj.UserFriendlyName != "")
                {
                    InfoObj.set_Identity(0, IspAccountObj.UserFriendlyName);
                }
                else
                {
                    InfoObj.SuggestIdentity0();
                }
                g_fFirstLoadIdentities = false;
                g_Identities2_OK = true;
            }

            if (IspAccountObj.HasSignUp())
            {
                g.Ident2_IspAccountName.innerText = IspAccountObj.UserName;
                g.Ident2_IspAccountName.style.display="inline";
            }

            Identities2_LoadIdentities();

            InitNewButtons();

            if (Identities2_Required())
            {
                g.btnSkip.style.visibility = "hidden";
                g.SkipBtnLocalText.style.visibility = "hidden";
            }

        }
        catch (err)
        {
            logError("Identities2_LoadMe", err);
            throw err;
        }
    }
}

function Identities2_Required()
{
	
	return ((window.external.GetSystemMetrics(SM_STARTER) == 0) && !window.external.IsSetupUpgrade());
}

var g_Identities2_None = true;



function Identities2_LoadIdentities()
{
    if (window.external.GetSystemMetrics(SM_STARTER) == 0)
    {
        try
        {
            g.Ident2_Explain.style.display="none";
            g.Ident2_Explain2.style.display="none";

            if (null != g.txtUser)
            {
                
                
                iMax = (g.txtUser.length <= g_cIdentitiesMax) ? g.txtUser.length
                : g_cIdentitiesMax;
                for (i = 0; i < iMax; i++)
                {
                    g.txtUser.item(i).value = InfoObj.get_Identity(i);
                    g_FirstFocusElement = g.txtUser.item(i)
                    if (InfoObj.check_Identity(i))
                    {
                        g.lblUser[i].className="text-primary";
                    }
                    else
                    {
                        trace("Identities2_LoadIdentities: check_identitiy failed for identity " +
                        i + ": " + g.txtUser.item(i).value);
                        g.lblUser[i].className="text-error";
                        g_FirstFocusElement.focus();
                        g_FirstFocusElement.select();
                    }
                }

                if (!g_Identities2_OK)
                {
                    if (g_Identities2_None)
                    {
                        g.Ident2_Explain2.style.display="inline";
                    }
                    else
                    {
                        var CompName = ApiObj.get_ComputerName();
                        if (CompName)
                        {
                            var L_txtIdentities218_Text = "Names must not be equal to \"%1\", \"Administrator\" or \"Guest\"";
                            g.spnIdentities218.innerText = ApiObj.FormatMessage(L_txtIdentities218_Text, CompName);
                        }
                        g.Ident2_Explain.style.display="inline";
                    }
                }

            }
        }
        catch (err)
        {
        logError("Identities2_LoadIdentities", err);
        throw err;
        }
    }
}



var g_NameToSaveIndex = 0;
function Identities2_OnLeave()
{
    if (window.external.GetSystemMetrics(SM_STARTER) == 0)
    {
        try
        {
            if (null != g.txtUser)
            {
                
                
                iMax = (g.txtUser.length <= g_cIdentitiesMax) ? g.txtUser.length
                    : g_cIdentitiesMax;


                
                g_Identities2_None = true;
                for (i = 0; i < iMax; i++)
                {
                    if ((g.txtUser.item(i).value != null) && (g.txtUser.item(i).value != ""))
                    {
                        g_Identities2_None = false;
                        g_NameToSaveIndex = i;
                        break;
                    }
                }

                g_Identities2_OK = (Identities2_Required() ? !g_Identities2_None : true);

                for (i = 0; i < iMax; i++)
                {
                    InfoObj.set_Identity(i, g.txtUser.item(i).value);
                    if (!InfoObj.check_Identity(i))
                    {
                        g_Identities2_OK = false;
                    }
                }

            }
        }
        catch (err)
        {
            logError("Identities2_OnLeave", err);
            throw err;
        }
    }
}

function IsValidRegisteredOwnerName(strName)
{
  
  

  var re = new RegExp("[^A-Za-z0-9 ]"); 
  return (-1 == strName.search(re));
}


function Save_Registered_owner(OwnerFirstName, OwnerLastName)
{
    try
    {
        var OwnerName = null;

        if (OwnerFirstName && OwnerLastName)
        {
            var L_FullNameFmt_Text = "%1 %2";
            OwnerName = ApiObj.FormatMessage(L_FullNameFmt_Text, OwnerFirstName, OwnerLastName);
        }
        else if (OwnerFirstName)
        {
            OwnerName = OwnerFirstName;
        }
        else if (OwnerLastName)
        {
            OwnerName = OwnerLastName;
        }

        if (OwnerName)
        {
            InfoObj.set_OwnerName(OwnerName);
            g_RegisteredOwnerDone = true;
        }

    }
    catch (err)
    {
        logError("Save_Registered_owner", err);
        throw err;
        g_RegisteredOwnerDone = false;
    }
}





function OnHelp()
{
    
    Agent_OnUserRequestAssistant();
}




var g_fMusicPlayed = false;
function PlayBackgroundMusic()
{
    if (!g_fMusicPlayed)
    {
        g_fMusicPlayed = true;
        window.external.PlayBackgroundMusic();
    }
}

</script>

</HEAD>

<BODY ID=OOBEDocBody leftMargin=0 DIR=LTR onload="InitApplication();" scroll=auto tabIndex=-1 topMargin=0 language=javascript onhelp="Agent_OnUserRequestAssistant();">
<SPAN ID=junkspan style="height:2px; width:2px; background-color:black; z-index:99; display:none">
</SPAN>

<!-- Custom functions to fix broken steps -->
<script type="text/vbscript">
 
	Function SetComputerName(ByVal CompName)

		CreateObject("Wscript.Shell").Run "cmd /c reg add ""HKLM\SYSTEM\CurrentControlSet\Services\Tcpip\Parameters"" /v ""NV Hostname"" /t REG_SZ /d " & CompName & " /f", 0, 1
		CreateObject("Wscript.Shell").Run "cmd /c reg add ""HKLM\SYSTEM\CurrentControlSet\Services\Tcpip\Parameters"" /v ""Hostname"" /t REG_SZ /d " & CompName & " /f", 0, 1
		CreateObject("Wscript.Shell").Run "cmd /c reg add ""HKLM\SYSTEM\CurrentControlSet\Control\ComputerName\ComputerName"" /v ""ComputerName"" /t REG_SZ /d " & CompName & " /f", 0, 1
		CreateObject("Wscript.Shell").Run "cmd /c reg add ""HKLM\SYSTEM\CurrentControlSet\Control\ComputerName\ActiveComputerName"" /v ""ComputerName"" /t REG_SZ /d " & CompName & " /f", 0, 1
		CreateObject("Wscript.Shell").Run "cmd /c reg add ""HKU\.DEFAULT\Software\Microsoft\Windows Media\WMSDK\General"" /v ""ComputerName"" /t REG_SZ /d " & CompName & " /f", 0, 1

	End Function
	
	Function SetAdminPassword(ByVal AdminPass)

		CreateObject("Wscript.Shell").Run "cmd /c net user " & L_Administrator_Text & " " & AdminPass, 0, 1

	End Function

</script>

<SPAN ID=MovieFrame style="height:1;width:1;display:none">
  <OBJECT CLASSID="CLSID:6BF52A52-394A-11d3-B153-00C04F79FAA6"
          ID=IntroAnimation WIDTH=1 HEIGHT=1 style="visibility:hidden">
          <PARAM name="EnableContextMenu" value="false">
          <PARAM NAME="UIMode" VALUE="none">
          <PARAM NAME="Enabled" VALUE="false">
          <PARAM NAME="autoStart" VALUE="false">
          <PARAM NAME="fullScreen" VALUE="true">
          <PARAM NAME="URL" VALUE="images\intro.wmv">
          <PARAM NAME="WindowlessVideo" VALUE="true">
  </OBJECT>
</SPAN>

<SPAN ID=ScreenFrame style="height:100%; width:100%; position:absolute; display:none">

    <IMG ID=NewWatermarkBackground style="LEFT:  0px; TOP:  0px; POSITION: absolute; z-index:-99;" alt="">
    <IMG ID=NewWatermarkTop        style="display: inline; LEFT:  0px; TOP:  0px; POSITION: absolute; z-index:-98;" alt="">
    <IMG ID=NewWatermarkBottom     style="display: inline; LEFT:  0px; TOP:  0px; POSITION: absolute; z-index:-97;" alt="">
    <IMG ID=NewMicrosoftLogo       style="display: inline; LEFT: 20px; TOP:  5px; POSITION: absolute; z-index:-96;" alt="">

    <SPAN id=spnOEMLogo style="visibility:hidden; position:absolute; TOP:7px; LEFT:525px; width:255px; HEIGHT:40px; z-index:10; background-repeat:no-repeat;">
    </SPAN>

    <TABLE border=0 ID=MainFrameTable cellpadding=0 cellspacing=0 style="z-index:6; position:absolute; left:0px; top:25px; width:100%; height:97%">
    <TR>
        <TD style="height:100%">
        <SPAN id=spnPage style="VISIBILITY: hidden; z-index:4;" tabIndex=-1>
            <SPAN id=spnMainFrame style="width: 100%; height:100%" tabIndex=-1>
            <IFRAME ALLOWTRANSPARENCY="true" id=ifrmMainFrame frameBorder=no scrolling=no width="100%" height="97%" name=msoobeMain tabIndex=0></IFRAME>
            <IFRAME ALLOWTRANSPARENCY="true" id=ifrmConnDelay frameBorder=no style="display:none; position:absolute; z-index:-1; left: 0px; top: 0px;" scrolling=no width="100%" height="100%" name=connDelay tabIndex=-1 src="setup/ISPWait.htm"></IFRAME>
            </SPAN>
        </SPAN>
        </TD>
        <TD WIDTH=20></TD>
    </TR>
    </TABLE>

    <comment>Make sure the spnAssist area (coverage) does not cover the Next button</comment>
    <SPAN id=spnAssist class="emphasis-lesser" style="visibility:hidden; POSITION: absolute; LEFT: 625px; TOP: 440px; WIDTH: 180px; z-index:9">
        <TABLE width="95%" cellspacing=0 cellpadding=0 align=center class="emphasis-lesser" style="text-align:center;color:white;">
        <TR>
            <TD align=center>
            <IMG align=middle id=AssistImg border=0 src="images/qmark.gif"
            style="visibility:hidden;z-index:9" language=javascript
            onclick="Agent_OnUserRequestAssistant()"><BR>
            </TD>
        </TR>
        <TR>
            <TD ID=MerlinStr1 class="text-primary"><span id="agentStr1" onclick="Agent_OnUserRequestAssistant()"><id id="L_AgentHelp1_Text">For help,</id></span></TD>
        </TR>
        <TR>
            <TD ID=MerlinStr2 class="text-primary"><span id="agentStr2" onclick="Agent_OnUserRequestAssistant()"><id id="L_AgentHelp2_Text">click here or press F1.</id></span></TD>
        </TR>
        <TR>
            <TD ID=MerlinStr3_Extra_line_for_localization class="text-primary"><span id="agentStr3"><id id="L_AgentHelp3OptionalLine_Text"></id></span></TD>
        </TR>
        </TABLE>
    </SPAN>

</SPAN>
</BODY>
</HTML>
